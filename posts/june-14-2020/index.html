<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>100 Days of Code - Day 31</title>
    <meta name="Description" content="D3">
    <link rel="stylesheet" href="/blog/css/index.css">
    <link rel="stylesheet" href="/blog/css/prism-base16-monokai.dark.css">
    <link rel="alternate" href="/blog/feed/feed.xml" type="application/atom+xml" title="Dev Blog">
  </head>
  <body>
    <header>
      <h1 class="home"><a href="/blog/">Dev Blog</a></h1>
      <ul class="nav">
        <li class="nav-item"><a href="/blog/">Home</a></li>
        <li class="nav-item"><a href="/blog/posts/">Archive</a></li>
        <li class="nav-item"><a href="/blog/about/">About Me</a></li>
      </ul>
    </header>

    <main class="tmpl-post">

      <h1>100 Days of Code - Day 31</h1>

<h3 id="day-31%3A-june-14%2C-2020">Day 31: June 14, 2020 <a class="direct-link" href="#day-31%3A-june-14%2C-2020">#</a></h3>
<h4 id="today's-progress">Today's Progress <a class="direct-link" href="#today's-progress">#</a></h4>
<p>Today I finished this <a href="https://chrisvaillancourt.github.io/d3-examples/marginal-histogram/">marginal histogram</a> and started a <a href="https://chrisvaillancourt.github.io/d3-examples/radar-weather-chart/">radar chart</a>.</p>
<h4 id="thoughts">Thoughts <a class="direct-link" href="#thoughts">#</a></h4>
<p>When working with SVG, it's important to keep in mind the drawing order of elements. You can create and append elements earlier in your chart setup to layer other elements (like chart axes) behind elements you append later. The <a href="https://chrisvaillancourt.github.io/d3-examples/radar-weather-chart/">radar chart</a> is a good example of drawing peripheral chart elements before we draw data elements,</p>
<p>Quick D3 tip: <a href="https://github.com/d3/d3-time/tree/v1.1.0">d3 time intervals</a> <code>range()</code> method can be used to create a list of datetime objects spaced by a specified interval (like a list of months in a year).</p>
<h4 id="work-examples">Work examples <a class="direct-link" href="#work-examples">#</a></h4>
<p>Final marginal histogram code:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> json <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'d3-fetch'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> min<span class="token punctuation">,</span> extent<span class="token punctuation">,</span> histogram<span class="token punctuation">,</span> range<span class="token punctuation">,</span> median <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'d3-array'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> select<span class="token punctuation">,</span> selectAll<span class="token punctuation">,</span> mouse <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'d3-selection'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> scaleLinear<span class="token punctuation">,</span> scaleSequential <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'d3-scale'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> axisBottom<span class="token punctuation">,</span> axisLeft <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'d3-axis'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> format <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'d3-format'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> Delaunay <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'d3-delaunay'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> timeFormat<span class="token punctuation">,</span> timeParse<span class="token punctuation">,</span> isoParse <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'d3-time-format'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> interpolateRainbow <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'d3-scale-chromatic'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> area<span class="token punctuation">,</span> curveBasis <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'d3-shape'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> createDimensions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../utils/createDimensions'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> transition <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'d3-transition'</span><span class="token punctuation">;</span><br><br><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">drawScatter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token comment">// 1. Access data</span><br><br>  <span class="token keyword">const</span> dataset <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">json</span><span class="token punctuation">(</span><span class="token string">'../data/nyc_weather_data.json'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">function</span> <span class="token function">xAccessor</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> d<span class="token punctuation">.</span>temperatureMin<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  <span class="token keyword">function</span> <span class="token function">yAccessor</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> d<span class="token punctuation">.</span>temperatureMax<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  <span class="token comment">// use a standard date to normalize our data with.</span><br>  <span class="token comment">// We'll do this in-case our data spans multiple years</span><br>  <span class="token comment">// allowing us to color the dots by the day/month</span><br>  <span class="token keyword">const</span> colorScaleYear <span class="token operator">=</span> <span class="token number">2000</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> parseDate <span class="token operator">=</span> <span class="token function">timeParse</span><span class="token punctuation">(</span><span class="token string">'%Y-%m-%d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">function</span> <span class="token function">colorAccessor</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> <span class="token function">parseDate</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>date<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setYear</span><span class="token punctuation">(</span>colorScaleYear<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  <span class="token comment">// 2. Create chart dimensions</span><br>  <span class="token keyword">var</span> dimensions <span class="token operator">=</span> <span class="token function">createDimensions</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>    customDimensions<span class="token operator">:</span> <span class="token punctuation">{</span><br>      histogramMargin<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span><br>      histogramHeight<span class="token operator">:</span> <span class="token number">70</span><span class="token punctuation">,</span><br>      legendWidth<span class="token operator">:</span> <span class="token number">250</span><span class="token punctuation">,</span><br>      legendHeight<span class="token operator">:</span> <span class="token number">26</span><span class="token punctuation">,</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// 3. Draw canvas</span><br><br>  <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'#wrapper'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'svg'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'width'</span><span class="token punctuation">,</span> dimensions<span class="token punctuation">.</span>width<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'height'</span><span class="token punctuation">,</span> dimensions<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">const</span> bounds <span class="token operator">=</span> wrapper<br>    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'g'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><br>      <span class="token string">'transform'</span><span class="token punctuation">,</span><br>      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translate(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dimensions<span class="token punctuation">.</span>margin<span class="token punctuation">.</span>left<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dimensions<span class="token punctuation">.</span>margin<span class="token punctuation">.</span>top<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px)</span><span class="token template-punctuation string">`</span></span><br>    <span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> boundsBackground <span class="token operator">=</span> bounds<br>    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'rect'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">classed</span><span class="token punctuation">(</span><span class="token string">'bounds-background'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'width'</span><span class="token punctuation">,</span> dimensions<span class="token punctuation">.</span>boundedWidth<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'height'</span><span class="token punctuation">,</span> dimensions<span class="token punctuation">.</span>boundedHeight<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// 4. Create scales</span><br><br>  <span class="token comment">// find the smallest min temp and largest max temp</span><br>  <span class="token comment">// we'll use the extent as the domain for both x &amp; y axis</span><br>  <span class="token keyword">var</span> tempsExtent <span class="token operator">=</span> <span class="token function">extent</span><span class="token punctuation">(</span><span class="token punctuation">[</span><br>    <span class="token operator">...</span>dataset<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>xAccessor<span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token operator">...</span>dataset<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>yAccessor<span class="token punctuation">)</span><span class="token punctuation">,</span><br>  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">const</span> xScale <span class="token operator">=</span> <span class="token function">scaleLinear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">domain</span><span class="token punctuation">(</span>tempsExtent<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> dimensions<span class="token punctuation">.</span>boundedWidth<span class="token punctuation">]</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">nice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">const</span> yScale <span class="token operator">=</span> <span class="token function">scaleLinear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">domain</span><span class="token punctuation">(</span>tempsExtent<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token punctuation">[</span>dimensions<span class="token punctuation">.</span>boundedHeight<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">nice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token comment">// use a sequential scale to cover the entire year</span><br><br>  <span class="token keyword">var</span> colorScale <span class="token operator">=</span> <span class="token function">scaleSequential</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">domain</span><span class="token punctuation">(</span><span class="token punctuation">[</span><br>      <span class="token function">timeParse</span><span class="token punctuation">(</span><span class="token string">'%m/%d/%Y'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">1/1/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>colorScaleYear<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>      <span class="token function">timeParse</span><span class="token punctuation">(</span><span class="token string">'%m/%d/%Y'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">12/31/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>colorScaleYear<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token punctuation">]</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">interpolator</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">invertDate</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token comment">// flip the value to better correspond with season colors</span><br>      <span class="token keyword">return</span> <span class="token function">interpolateRainbow</span><span class="token punctuation">(</span><span class="token operator">-</span>d<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// 5. Draw data</span><br>  <span class="token keyword">var</span> dotsGroup <span class="token operator">=</span> bounds<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'g'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> dots <span class="token operator">=</span> dotsGroup<br>    <span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token string">'.dot'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>dataset<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> d<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'circle'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'dot'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'cx'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">xScale</span><span class="token punctuation">(</span><span class="token function">xAccessor</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'cy'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">yScale</span><span class="token punctuation">(</span><span class="token function">yAccessor</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'r'</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">'fill'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">setFill</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">return</span> <span class="token function">colorScale</span><span class="token punctuation">(</span><span class="token function">colorAccessor</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">var</span> rightHistogramGenerator <span class="token operator">=</span> <span class="token function">histogram</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">domain</span><span class="token punctuation">(</span>yScale<span class="token punctuation">.</span><span class="token function">domain</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span>yAccessor<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">thresholds</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> rightHistogramBins <span class="token operator">=</span> <span class="token function">rightHistogramGenerator</span><span class="token punctuation">(</span>dataset<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> rightHistogramYScale <span class="token operator">=</span> <span class="token function">scaleLinear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">domain</span><span class="token punctuation">(</span><span class="token function">extent</span><span class="token punctuation">(</span>rightHistogramBins<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> d<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token punctuation">[</span>dimensions<span class="token punctuation">.</span>histogramHeight<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> rightHistogramBounds <span class="token operator">=</span> bounds<br>    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'g'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'right-histogram'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><br>      <span class="token string">'transform'</span><span class="token punctuation">,</span><br>      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translate(<br>        </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dimensions<span class="token punctuation">.</span>boundedWidth <span class="token operator">+</span> dimensions<span class="token punctuation">.</span>histogramMargin<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px, -</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><br>        dimensions<span class="token punctuation">.</span>histogramHeight<br>      <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px) rotate(90deg)</span><span class="token template-punctuation string">`</span></span><br>    <span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> rightHistogramLineGenerator <span class="token operator">=</span> <span class="token function">area</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">yScale</span><span class="token punctuation">(</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>x0 <span class="token operator">+</span> d<span class="token punctuation">.</span>x1<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">y0</span><span class="token punctuation">(</span>dimensions<span class="token punctuation">.</span>histogramHeight<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">y1</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">rightHistogramYScale</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">curve</span><span class="token punctuation">(</span>curveBasis<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> rightHistogramElement <span class="token operator">=</span> rightHistogramBounds<br>    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'d'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">rightHistogramLineGenerator</span><span class="token punctuation">(</span>rightHistogramBins<span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'histogram-area'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">var</span> topHistogramGenerator <span class="token operator">=</span> <span class="token function">histogram</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">domain</span><span class="token punctuation">(</span>xScale<span class="token punctuation">.</span><span class="token function">domain</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span>xAccessor<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">thresholds</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> topHistogramBins <span class="token operator">=</span> <span class="token function">topHistogramGenerator</span><span class="token punctuation">(</span>dataset<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> topHistogramYScale <span class="token operator">=</span> <span class="token function">scaleLinear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">domain</span><span class="token punctuation">(</span><span class="token function">extent</span><span class="token punctuation">(</span>topHistogramBins<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> d<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token punctuation">[</span>dimensions<span class="token punctuation">.</span>histogramHeight<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> topHistogramBounds <span class="token operator">=</span> bounds<br>    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'g'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'top-histogram'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><br>      <span class="token string">'transform'</span><span class="token punctuation">,</span><br>      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translate(0px, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><br>        <span class="token operator">-</span>dimensions<span class="token punctuation">.</span>histogramHeight <span class="token operator">-</span> dimensions<span class="token punctuation">.</span>histogramMargin<br>      <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px)</span><span class="token template-punctuation string">`</span></span><br>    <span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> topHistogramLineGenerator <span class="token operator">=</span> <span class="token function">area</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">xScale</span><span class="token punctuation">(</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>x0 <span class="token operator">+</span> d<span class="token punctuation">.</span>x1<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">y0</span><span class="token punctuation">(</span>dimensions<span class="token punctuation">.</span>histogramHeight<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">y1</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">topHistogramYScale</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">curve</span><span class="token punctuation">(</span>curveBasis<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> topHistogramElement <span class="token operator">=</span> topHistogramBounds<br>    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'d'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">topHistogramLineGenerator</span><span class="token punctuation">(</span>topHistogramBins<span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'histogram-area'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// create a new Delaunay triangulation for interaction</span><br>  <span class="token keyword">var</span> delaunay <span class="token operator">=</span> Delaunay<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><br>    dataset<span class="token punctuation">,</span><br>    <span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">xScale</span><span class="token punctuation">(</span><span class="token function">xAccessor</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">yScale</span><span class="token punctuation">(</span><span class="token function">yAccessor</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><br>  <span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// turn the delaunay triangulation into a voronoi diagram</span><br>  <span class="token keyword">var</span> voronoi <span class="token operator">=</span> delaunay<span class="token punctuation">.</span><span class="token function">voronoi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// specify bounds size</span><br>  voronoi<span class="token punctuation">.</span>xmax <span class="token operator">=</span> dimensions<span class="token punctuation">.</span>boundedWidth<span class="token punctuation">;</span><br>  voronoi<span class="token punctuation">.</span>ymax <span class="token operator">=</span> dimensions<span class="token punctuation">.</span>boundedHeight<span class="token punctuation">;</span><br><br>  bounds<br>    <span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token string">'.voronoi'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>dataset<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">enter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'voronoi'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'d'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">createPath</span><span class="token punctuation">(</span><span class="token parameter">d<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token comment">// create each path's d attribute string by passing voronoi.randerCell() the index</span><br>      <span class="token comment">// of our data point</span><br>      <span class="token keyword">return</span> voronoi<span class="token punctuation">.</span><span class="token function">renderCell</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// 6. Draw peripherals</span><br><br>  <span class="token keyword">const</span> xAxisGenerator <span class="token operator">=</span> <span class="token function">axisBottom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">scale</span><span class="token punctuation">(</span>xScale<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">const</span> xAxis <span class="token operator">=</span> bounds<br>    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'g'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>xAxisGenerator<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">'transform'</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translateY(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dimensions<span class="token punctuation">.</span>boundedHeight<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">const</span> xAxisLabel <span class="token operator">=</span> xAxis<br>    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'text'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'x-axis-label'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">,</span> dimensions<span class="token punctuation">.</span>boundedWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">,</span> dimensions<span class="token punctuation">.</span>margin<span class="token punctuation">.</span>bottom <span class="token operator">-</span> <span class="token number">10</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">'Minimum Temperature (&amp;deg;F)'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">const</span> yAxisGenerator <span class="token operator">=</span> <span class="token function">axisLeft</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">scale</span><span class="token punctuation">(</span>yScale<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ticks</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">const</span> yAxis <span class="token operator">=</span> bounds<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'g'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>yAxisGenerator<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">const</span> yAxisLabel <span class="token operator">=</span> yAxis<br>    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'text'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'y-axis-label'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">,</span> <span class="token operator">-</span>dimensions<span class="token punctuation">.</span>boundedHeight <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token operator">-</span>dimensions<span class="token punctuation">.</span>margin<span class="token punctuation">.</span>left <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">'Maximum Temperature (&amp;deg;F)'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">var</span> legendGroup <span class="token operator">=</span> bounds<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'g'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><br>    <span class="token string">'transform'</span><span class="token punctuation">,</span><br>    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translate(<br>      </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dimensions<span class="token punctuation">.</span>boundedWidth <span class="token operator">-</span> dimensions<span class="token punctuation">.</span>legendWidth <span class="token operator">-</span> <span class="token number">9</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,<br>      </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dimensions<span class="token punctuation">.</span>boundedHeight <span class="token operator">-</span> <span class="token number">37</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><br>  <span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">var</span> defs <span class="token operator">=</span> wrapper<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'defs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> numberOfGradientStops <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span><br>  <span class="token comment">// create an array of desired number of stops and normalize indices to go up to 1;</span><br>  <span class="token keyword">var</span> stops <span class="token operator">=</span> <span class="token function">range</span><span class="token punctuation">(</span>numberOfGradientStops<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><br>    <span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span> <span class="token operator">=></span> i <span class="token operator">/</span> <span class="token punctuation">(</span>numberOfGradientStops <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><br>  <span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> legendGradientId <span class="token operator">=</span> <span class="token string">'legend-gradient'</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> gradient <span class="token operator">=</span> defs<br>    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'linearGradient'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span> legendGradientId<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token string">'stop'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>stops<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">enter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'stop'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'stop-color'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">interpolateRainbow</span><span class="token punctuation">(</span><span class="token operator">-</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'offset'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>d <span class="token operator">*</span> <span class="token number">100</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">%</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">var</span> legendGradient <span class="token operator">=</span> legendGroup<br>    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'rect'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'height'</span><span class="token punctuation">,</span> dimensions<span class="token punctuation">.</span>legendHeight<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'width'</span><span class="token punctuation">,</span> dimensions<span class="token punctuation">.</span>legendWidth<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">'fill'</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">url(#</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>legendGradientId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// create an array of key dates</span><br>  <span class="token keyword">var</span> tickValues <span class="token operator">=</span> <span class="token punctuation">[</span><br>    <span class="token function">timeParse</span><span class="token punctuation">(</span><span class="token string">'%m/%d/%Y'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">4/1/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>colorScaleYear<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token function">timeParse</span><span class="token punctuation">(</span><span class="token string">'%m/%d/%Y'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">7/1/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>colorScaleYear<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token function">timeParse</span><span class="token punctuation">(</span><span class="token string">'%m/%d/%Y'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">10/1/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>colorScaleYear<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>  <span class="token punctuation">]</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">var</span> legendTickScale <span class="token operator">=</span> <span class="token function">scaleLinear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">domain</span><span class="token punctuation">(</span>colorScale<span class="token punctuation">.</span><span class="token function">domain</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> dimensions<span class="token punctuation">.</span>legendWidth<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">var</span> legendValues <span class="token operator">=</span> legendGroup<br>    <span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token string">'.legend-value'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>tickValues<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">enter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'text'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'legend-value'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">,</span> legendTickScale<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token function">timeFormat</span><span class="token punctuation">(</span><span class="token string">'%b'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">var</span> legendValueTicks <span class="token operator">=</span> legendGroup<br>    <span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token string">'.legend-tick'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>tickValues<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">enter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'line'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'legend-tick'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'x1'</span><span class="token punctuation">,</span> legendTickScale<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'x2'</span><span class="token punctuation">,</span> legendTickScale<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'y1'</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// 7. Set up interactions</span><br>  <span class="token keyword">var</span> tooltip <span class="token operator">=</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'#tooltip'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> formatMetric <span class="token operator">=</span> <span class="token function">format</span><span class="token punctuation">(</span><span class="token string">'.2f'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> dateParser <span class="token operator">=</span> <span class="token function">timeParse</span><span class="token punctuation">(</span><span class="token string">'%Y-%m-%d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> formatDate <span class="token operator">=</span> <span class="token function">timeFormat</span><span class="token punctuation">(</span><span class="token string">'%B %A %-d, %Y'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">var</span> hoverElementsGroup <span class="token operator">=</span> bounds<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'g'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'opacity'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">var</span> dayDot <span class="token operator">=</span> hoverElementsGroup<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'circle'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'tooltip-dot'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  bounds<br>    <span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token string">'.voronoi'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'mouseenter'</span><span class="token punctuation">,</span> handleVoronoiMouseEnter<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'mouseleave'</span><span class="token punctuation">,</span> handleVoronoiMouseLeave<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// we need to use a rect instead of a &lt;line> because a line's x1 &amp; x2 attributes won't respect CSS transitions</span><br>  <span class="token comment">// but a path's d attribute will</span><br>  <span class="token keyword">var</span> horizontalLine <span class="token operator">=</span> hoverElementsGroup<br>    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'rect'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'hover-line'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> verticalLine <span class="token operator">=</span> hoverElementsGroup<br>    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'rect'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'hover-line'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  legendGradient<br>    <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'mousemove'</span><span class="token punctuation">,</span> handleLegendMouseMove<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'mouseleave'</span><span class="token punctuation">,</span> handleLegendMouseLeave<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">const</span> legendHighlightBarWidth <span class="token operator">=</span> dimensions<span class="token punctuation">.</span>legendWidth <span class="token operator">*</span> <span class="token number">0.05</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> legendHighlightGroup <span class="token operator">=</span> legendGroup<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'g'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'opacity'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> legendHighlightBar <span class="token operator">=</span> legendHighlightGroup<br>    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'rect'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'legend-highlight-bar'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'width'</span><span class="token punctuation">,</span> legendHighlightBarWidth<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'height'</span><span class="token punctuation">,</span> dimensions<span class="token punctuation">.</span>legendHeight<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// we need to shift the text by half the bar width</span><br>  <span class="token comment">// this lets us center the text with the bar</span><br>  <span class="token keyword">var</span> legendHighlightText <span class="token operator">=</span> legendHighlightGroup<br>    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'text'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'legend-highlight-text'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">,</span> legendHighlightBarWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token comment">// path's aren't visible until they have a d attribute</span><br>  <span class="token keyword">var</span> hoverTopHistogram <span class="token operator">=</span> topHistogramBounds<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> hoverRightHistogram <span class="token operator">=</span> rightHistogramBounds<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">function</span> <span class="token function">handleLegendMouseMove</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// we need to determine which dates the mouse is hovering over</span><br>    <span class="token comment">// we can determine the hover point with the mouse's x position relative to the legend</span><br>    <span class="token comment">// mouse() can give us [x,y] coordinates</span><br>    <span class="token comment">// the coordinates are relative to the element passed to mouse()</span><br>    <span class="token comment">// 'this' is the element that the mouse event was initialzed on</span><br><br>    <span class="token keyword">const</span> <span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">mouse</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// use a scale's invert method to go from range dimension -> domain dimension</span><br>    <span class="token keyword">const</span> minDateToHighlight <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><br>      legendTickScale<span class="token punctuation">.</span><span class="token function">invert</span><span class="token punctuation">(</span>x <span class="token operator">-</span> legendHighlightBarWidth<span class="token punctuation">)</span><br>    <span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">const</span> maxDateToHighlight <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><br>      legendTickScale<span class="token punctuation">.</span><span class="token function">invert</span><span class="token punctuation">(</span>x <span class="token operator">+</span> legendHighlightBarWidth<span class="token punctuation">)</span><br>    <span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token comment">// if we use the raw x position of the mouse, it could go out of bounds when we approach</span><br>    <span class="token comment">// the left or right side.</span><br>    <span class="token comment">// we can use median to bound the value</span><br>    <span class="token comment">// There are three outcomes when we pass an array of [min, value, max]:</span><br>    <span class="token comment">// 1) the value is lower than the min, resulting in the sorted array [value, min, max], making min the middle value</span><br>    <span class="token comment">// 2) the value is between the min and the max, resulting in the sorted array [min,value, max], making min the middle value</span><br>    <span class="token comment">// 3) the value is higher than the max, resulting in the sorted array [min, max, value], making max the middle value</span><br>    <span class="token keyword">const</span> barX <span class="token operator">=</span> <span class="token function">median</span><span class="token punctuation">(</span><span class="token punctuation">[</span><br>      <span class="token number">0</span><span class="token punctuation">,</span><br>      x <span class="token operator">-</span> legendHighlightBarWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span><br>      dimensions<span class="token punctuation">.</span>legendWidth <span class="token operator">-</span> legendHighlightBarWidth<span class="token punctuation">,</span><br>    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    legendHighlightGroup<br>      <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">'opacity'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">'transform'</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translateX(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>barX<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    legendHighlightText<br>      <span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">[</span><br>        <span class="token function">timeFormat</span><span class="token punctuation">(</span><span class="token string">'%b %d'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>minDateToHighlight<span class="token punctuation">)</span><span class="token punctuation">,</span><br>        <span class="token function">timeFormat</span><span class="token punctuation">(</span><span class="token string">'%b %d'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>maxDateToHighlight<span class="token punctuation">)</span><span class="token punctuation">,</span><br>      <span class="token punctuation">]</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token comment">// dim normal legend ticks</span><br>    legendValues<span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">'opacity'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    legendValueTicks<span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">'opacity'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    dots<span class="token punctuation">.</span><span class="token function">transition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">duration</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">'opacity'</span><span class="token punctuation">,</span> <span class="token number">0.08</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'r'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">var</span> relevantDots <span class="token operator">=</span> dots<br>      <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>isDayWithinRange<span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">transition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">duration</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">'opacity'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'r'</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">function</span> <span class="token function">getYear</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">return</span> <span class="token operator">+</span><span class="token function">timeFormat</span><span class="token punctuation">(</span><span class="token string">'%Y'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>    <span class="token keyword">function</span> <span class="token function">isDayWithinRange</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token comment">// we want to highlight dates on each edge when we get close to the edge</span><br>      <span class="token keyword">var</span> date <span class="token operator">=</span> <span class="token function">colorAccessor</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getYear</span><span class="token punctuation">(</span>minDateToHighlight<span class="token punctuation">)</span> <span class="token operator">&lt;</span> colorScaleYear<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token comment">// if dates wrap around to the previous year</span><br>        <span class="token comment">// check if the date is after the min date</span><br>        <span class="token keyword">return</span> <span class="token punctuation">(</span><br>          date <span class="token operator">>=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>minDateToHighlight<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setYear</span><span class="token punctuation">(</span>colorScaleYear<span class="token punctuation">)</span> <span class="token operator">||</span><br>          date <span class="token operator">&lt;=</span> maxDateToHighlight<br>        <span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getYear</span><span class="token punctuation">(</span>maxDateToHighlight<span class="token punctuation">)</span> <span class="token operator">></span> colorScaleYear<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token comment">// if dates wrap around to next year</span><br>        <span class="token comment">// check if the date is before the max date</span><br>        <span class="token keyword">return</span> <span class="token punctuation">(</span><br>          date <span class="token operator">&lt;=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>maxDateToHighlight<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setYear</span><span class="token punctuation">(</span>colorScaleYear<span class="token punctuation">)</span> <span class="token operator">||</span><br>          date <span class="token operator">>=</span> minDateToHighlight<br>        <span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>        <span class="token keyword">return</span> date <span class="token operator">>=</span> minDateToHighlight <span class="token operator">&amp;&amp;</span> date <span class="token operator">&lt;=</span> maxDateToHighlight<span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br>    <span class="token keyword">const</span> hoveredDate <span class="token operator">=</span> <span class="token function">isoParse</span><span class="token punctuation">(</span>legendTickScale<span class="token punctuation">.</span><span class="token function">invert</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">var</span> hoveredDates <span class="token operator">=</span> dataset<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>isDayWithinRange<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    hoverTopHistogram<br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'d'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">setHoverTopHistogram</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">return</span> <span class="token function">topHistogramLineGenerator</span><span class="token punctuation">(</span><span class="token function">topHistogramGenerator</span><span class="token punctuation">(</span>hoveredDates<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'fill'</span><span class="token punctuation">,</span> <span class="token function">colorScale</span><span class="token punctuation">(</span>hoveredDate<span class="token punctuation">)</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'stroke'</span><span class="token punctuation">,</span> <span class="token string">'white'</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">'opacity'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    hoverRightHistogram<br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'d'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">setHoverRightHistogram</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">return</span> <span class="token function">rightHistogramLineGenerator</span><span class="token punctuation">(</span><br>          <span class="token function">rightHistogramGenerator</span><span class="token punctuation">(</span>hoveredDates<span class="token punctuation">)</span><br>        <span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'fill'</span><span class="token punctuation">,</span> <span class="token function">colorScale</span><span class="token punctuation">(</span>hoveredDate<span class="token punctuation">)</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'stroke'</span><span class="token punctuation">,</span> <span class="token string">'white'</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">'opacity'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">function</span> <span class="token function">handleLegendMouseLeave</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    dots<span class="token punctuation">.</span><span class="token function">transition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">duration</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">'opacity'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'r'</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    legendHighlightGroup<span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">'opacity'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    legendValues<span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">'opacity'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    legendValueTicks<span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">'opacity'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    hoverRightHistogram<span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">'opacity'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    hoverTopHistogram<span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">'opacity'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">function</span> <span class="token function">handleVoronoiMouseEnter</span><span class="token punctuation">(</span><span class="token parameter">datum</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    tooltip<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'#min-temperature'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token function">formatMetric</span><span class="token punctuation">(</span><span class="token function">xAccessor</span><span class="token punctuation">(</span>datum<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    tooltip<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'#max-temperature'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token function">formatMetric</span><span class="token punctuation">(</span><span class="token function">yAccessor</span><span class="token punctuation">(</span>datum<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    tooltip<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'#date'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token function">formatDate</span><span class="token punctuation">(</span><span class="token function">dateParser</span><span class="token punctuation">(</span>datum<span class="token punctuation">.</span>date<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token comment">// get x and y value of the dot, offset by top and left margins</span><br>    <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token function">xScale</span><span class="token punctuation">(</span><span class="token function">xAccessor</span><span class="token punctuation">(</span>datum<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">const</span> y <span class="token operator">=</span> <span class="token function">yScale</span><span class="token punctuation">(</span><span class="token function">yAccessor</span><span class="token punctuation">(</span>datum<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">const</span> tooltipX <span class="token operator">=</span> x <span class="token operator">+</span> dimensions<span class="token punctuation">.</span>margin<span class="token punctuation">.</span>left<span class="token punctuation">;</span><br>    <span class="token keyword">const</span> tooltipY <span class="token operator">=</span> y <span class="token operator">+</span> dimensions<span class="token punctuation">.</span>margin<span class="token punctuation">.</span>top <span class="token operator">-</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token comment">// adjust 4px to prevent overlap with circle</span><br><br>    tooltip<br>      <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><br>        <span class="token string">'transform'</span><span class="token punctuation">,</span><br>        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translate(calc(-50% + </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>tooltipX<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px), calc(-100% + </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>tooltipY<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px))</span><span class="token template-punctuation string">`</span></span><br>      <span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">'opacity'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    dayDot<br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'cx'</span><span class="token punctuation">,</span> <span class="token function">xScale</span><span class="token punctuation">(</span><span class="token function">xAccessor</span><span class="token punctuation">(</span>datum<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'cy'</span><span class="token punctuation">,</span> <span class="token function">yScale</span><span class="token punctuation">(</span><span class="token function">yAccessor</span><span class="token punctuation">(</span>datum<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'r'</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">const</span> hoverLineThickness <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span><br><br>    horizontalLine<br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">,</span> y <span class="token operator">-</span> hoverLineThickness <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><br>        <span class="token string">'width'</span><span class="token punctuation">,</span><br>        dimensions<span class="token punctuation">.</span>boundedWidth <span class="token operator">+</span><br>          dimensions<span class="token punctuation">.</span>histogramMargin <span class="token operator">+</span><br>          dimensions<span class="token punctuation">.</span>histogramHeight <span class="token operator">-</span><br>          x<br>      <span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'height'</span><span class="token punctuation">,</span> hoverLineThickness<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    verticalLine<br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">,</span> x <span class="token operator">-</span> hoverLineThickness <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token operator">-</span>dimensions<span class="token punctuation">.</span>histogramMargin <span class="token operator">-</span> dimensions<span class="token punctuation">.</span>histogramHeight<span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'width'</span><span class="token punctuation">,</span> hoverLineThickness<span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><br>        <span class="token string">'height'</span><span class="token punctuation">,</span><br>        y <span class="token operator">+</span> dimensions<span class="token punctuation">.</span>histogramMargin <span class="token operator">+</span> dimensions<span class="token punctuation">.</span>histogramHeight<br>      <span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    hoverElementsGroup<span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">'opacity'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token comment">// draw new dot to appear on top</span><br>  <span class="token punctuation">}</span><br>  <span class="token keyword">function</span> <span class="token function">handleVoronoiMouseLeave</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    tooltip<span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">'opacity'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    hoverElementsGroup<span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">'opacity'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token comment">// selectAll('.tooltip-dot').remove();</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><span class="token function">drawScatter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">'render chart'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span><br></code></pre>
<p>Initial radar weather chart code:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> json <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'d3-fetch'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> select <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'d3-selection'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> timeParse<span class="token punctuation">,</span> timeFormat <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'d3-time-format'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> scaleTime<span class="token punctuation">,</span> scaleLinear <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'d3-scale'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> extent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'d3-array'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> timeMonths <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'d3-time'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> format <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'d3-format'</span><span class="token punctuation">;</span><br><br><span class="token keyword">function</span> <span class="token function">createDimensions</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> customDimensions <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token comment">// Used to create a dimensions data obj for creating chart dimensions.</span><br>  <span class="token comment">// Pass customDimesions to return an obj with extra key/value pairs.</span><br>  <span class="token keyword">return</span> <span class="token punctuation">{</span><br>    margin<span class="token operator">:</span> <span class="token punctuation">{</span><br>      top<span class="token operator">:</span> <span class="token number">120</span><span class="token punctuation">,</span><br>      right<span class="token operator">:</span> <span class="token number">120</span><span class="token punctuation">,</span><br>      bottom<span class="token operator">:</span> <span class="token number">120</span><span class="token punctuation">,</span><br>      left<span class="token operator">:</span> <span class="token number">120</span><span class="token punctuation">,</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token keyword">get</span> <span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">return</span> <span class="token punctuation">(</span><br>        <span class="token punctuation">(</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>innerWidth <span class="token operator">></span> <span class="token number">1500</span> <span class="token operator">?</span> <span class="token number">1500</span> <span class="token operator">:</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">)</span> <span class="token operator">-</span><br>          <span class="token keyword">this</span><span class="token punctuation">.</span>margin<span class="token punctuation">.</span>left <span class="token operator">-</span><br>          <span class="token keyword">this</span><span class="token punctuation">.</span>margin<span class="token punctuation">.</span>right<span class="token punctuation">)</span> <span class="token operator">*</span><br>        <span class="token number">0.75</span><br>      <span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token keyword">get</span> <span class="token function">boundedWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>width <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>margin<span class="token punctuation">.</span>left <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>margin<span class="token punctuation">.</span>right<span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token keyword">get</span> <span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>width<span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token keyword">get</span> <span class="token function">boundedHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>height <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>margin<span class="token punctuation">.</span>top <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>margin<span class="token punctuation">.</span>bottom<span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token keyword">get</span> <span class="token function">radius</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token keyword">get</span> <span class="token function">boundedRadius</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>radius <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>margin<span class="token punctuation">.</span>left <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>margin<span class="token punctuation">.</span>right<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token operator">...</span>customDimensions<span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">function</span> <span class="token function">setupDom</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">var</span> parent <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#flex'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> fragment <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DocumentFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> wrapper <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  wrapper<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token string">'wrapper'</span><span class="token punctuation">;</span><br>  fragment<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  parent<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>fragment<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">createRadarChart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token comment">// step 1) access data</span><br><br>  <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">json</span><span class="token punctuation">(</span><span class="token string">'../data/nyc_weather_data.json'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">function</span> <span class="token function">temperatureMinAccessor</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> d<span class="token punctuation">.</span>temperatureMin<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  <span class="token keyword">function</span> <span class="token function">temperatureMaxAccessor</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> d<span class="token punctuation">.</span>temperatureMax<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  <span class="token keyword">function</span> <span class="token function">uvAccessor</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> d<span class="token punctuation">.</span>uvIndex<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  <span class="token keyword">function</span> <span class="token function">precipitationProbabilityAccessor</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> d<span class="token punctuation">.</span>precipProbability<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  <span class="token keyword">function</span> <span class="token function">precipitationTypeAccessor</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> d<span class="token punctuation">.</span>precipType<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  <span class="token keyword">function</span> <span class="token function">cloudAccessor</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> d<span class="token punctuation">.</span>cloudCover<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  <span class="token keyword">var</span> dateParser <span class="token operator">=</span> <span class="token function">timeParse</span><span class="token punctuation">(</span><span class="token string">'%Y-%m-%d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">function</span> <span class="token function">dateAccessor</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> <span class="token function">dateParser</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>date<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token comment">// step 2) create chart dimensions</span><br>  <span class="token keyword">var</span> dimensions <span class="token operator">=</span> <span class="token function">createDimensions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token comment">// step 3) draw canvas</span><br>  <span class="token keyword">var</span> wrapper <span class="token operator">=</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'#wrapper'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'svg'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'width'</span><span class="token punctuation">,</span> dimensions<span class="token punctuation">.</span>width<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'height'</span><span class="token punctuation">,</span> dimensions<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// shift bounds to start in the center of the chart</span><br>  <span class="token comment">// This will be helpful when we decide where to place data and peripheral elements</span><br>  <span class="token comment">// We'll only need to know where they sit with respect to the center of the circle</span><br>  <span class="token keyword">var</span> bounds <span class="token operator">=</span> wrapper<br>    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'g'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><br>      <span class="token string">'transform'</span><span class="token punctuation">,</span><br>      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translate(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dimensions<span class="token punctuation">.</span>margin<span class="token punctuation">.</span>left <span class="token operator">+</span> dimensions<span class="token punctuation">.</span>boundedRadius<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><br>        dimensions<span class="token punctuation">.</span>margin<span class="token punctuation">.</span>top <span class="token operator">+</span> dimensions<span class="token punctuation">.</span>boundedRadius<br>      <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px)</span><span class="token template-punctuation string">`</span></span><br>    <span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// step 4) create scales</span><br>  <span class="token comment">// the location of a data element around the radar chart's center corresponds to its date</span><br>  <span class="token keyword">var</span> angleScale <span class="token operator">=</span> <span class="token function">scaleTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">domain</span><span class="token punctuation">(</span><span class="token function">extent</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> dateAccessor<span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// this is in radians</span><br>  <span class="token comment">// a circle has 2π radians</span><br>  <span class="token keyword">var</span> radiusScale <span class="token operator">=</span> <span class="token function">scaleLinear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">domain</span><span class="token punctuation">(</span><br>      <span class="token function">extent</span><span class="token punctuation">(</span><span class="token punctuation">[</span><br>        <span class="token operator">...</span>data<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>temperatureMaxAccessor<span class="token punctuation">)</span><span class="token punctuation">,</span><br>        <span class="token operator">...</span>data<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>temperatureMinAccessor<span class="token punctuation">)</span><span class="token punctuation">,</span><br>      <span class="token punctuation">]</span><span class="token punctuation">)</span><br>    <span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> dimensions<span class="token punctuation">.</span>boundedRadius<span class="token punctuation">]</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">nice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">function</span> <span class="token function">getXFromDataPoint</span><span class="token punctuation">(</span><span class="token parameter">d<span class="token punctuation">,</span> offset <span class="token operator">=</span> <span class="token number">1.4</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> <span class="token function">getCoordsForAngle</span><span class="token punctuation">(</span><span class="token function">angleScale</span><span class="token punctuation">(</span><span class="token function">dateAccessor</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> offset<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  <span class="token keyword">function</span> <span class="token function">getYFromDataPoint</span><span class="token punctuation">(</span><span class="token parameter">d<span class="token punctuation">,</span> offset <span class="token operator">=</span> <span class="token number">1.4</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> <span class="token function">getCoordsForAngle</span><span class="token punctuation">(</span><span class="token function">angleScale</span><span class="token punctuation">(</span><span class="token function">dateAccessor</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> offset<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  <span class="token comment">// step 5) draw peripherals</span><br>  <span class="token comment">// doing this before data drawing (typically step 5)</span><br>  <span class="token comment">// drawing peripherals first is helpful when we want to layer data elements on top of chart peripherals</span><br><br>  <span class="token keyword">var</span> peripherals <span class="token operator">=</span> bounds<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'g'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">function</span> <span class="token function">getCoordsForAngle</span><span class="token punctuation">(</span><span class="token parameter">angle<span class="token punctuation">,</span> offset <span class="token operator">=</span> <span class="token number">1</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// dimensions.boundedRadius * offset is the triangle's hypotenuse</span><br>    <span class="token comment">// we need to adjust the angle</span><br>    <span class="token comment">// because the radar chart starts in the center, above our origin point</span><br>    <span class="token keyword">return</span> <span class="token punctuation">[</span><br>      Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>angle <span class="token operator">-</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">*</span> dimensions<span class="token punctuation">.</span>boundedRadius <span class="token operator">*</span> offset<span class="token punctuation">,</span><br>      Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>angle <span class="token operator">-</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">*</span> dimensions<span class="token punctuation">.</span>boundedRadius <span class="token operator">*</span> offset<span class="token punctuation">,</span><br>    <span class="token punctuation">]</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  <span class="token comment">// create an array for each month in the data</span><br>  <span class="token comment">// d3 time intervals range() method will return a list of datetime objects</span><br>  <span class="token comment">// spaced by a specified interval</span><br>  <span class="token keyword">var</span> months <span class="token operator">=</span> <span class="token function">timeMonths</span><span class="token punctuation">(</span><span class="token operator">...</span>angleScale<span class="token punctuation">.</span><span class="token function">domain</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// same as timeMonth.range(...angleScale.domain())</span><br>  months<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">drawLinesForEachMonth</span><span class="token punctuation">(</span><span class="token parameter">month</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">var</span> angle <span class="token operator">=</span> <span class="token function">angleScale</span><span class="token punctuation">(</span>month<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">const</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">getCoordsForAngle</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token comment">// we don't need to specify x1/y1 because they default to 0</span><br>    peripherals<br>      <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'line'</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'x2'</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'y2'</span><span class="token punctuation">,</span> y<span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'grid-line'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">const</span> <span class="token punctuation">[</span>labelX<span class="token punctuation">,</span> labelY<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">getCoordsForAngle</span><span class="token punctuation">(</span>angle<span class="token punctuation">,</span> <span class="token number">1.38</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    peripherals<br>      <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'text'</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">,</span> labelX<span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">,</span> labelY<span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'tick-label'</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token function">timeFormat</span><span class="token punctuation">(</span><span class="token string">'%b'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>month<span class="token punctuation">)</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><br>        <span class="token string">'text-anchor'</span><span class="token punctuation">,</span><br>        <span class="token comment">// dynamically set value based on x position</span><br>        Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>labelX<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">5</span> <span class="token operator">?</span> <span class="token string">'middle'</span> <span class="token operator">:</span> labelX <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token string">'start'</span> <span class="token operator">:</span> <span class="token string">'end'</span><br>      <span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> temperatureTicks <span class="token operator">=</span> radiusScale<span class="token punctuation">.</span><span class="token function">ticks</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> gridCircles <span class="token operator">=</span> temperatureTicks<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">drawCircleGridLines</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> peripherals<br>      <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'circle'</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'r'</span><span class="token punctuation">,</span> <span class="token function">radiusScale</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'grid-line'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> tickLabelBackgrounds <span class="token operator">=</span> temperatureTicks<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>d<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span><br>    <span class="token keyword">return</span> peripherals<br>      <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'rect'</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token function">radiusScale</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">10</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'width'</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'height'</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'fill'</span><span class="token punctuation">,</span> <span class="token string">'#ffffff'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> tickLabels <span class="token operator">=</span> temperatureTicks<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>d<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span><br>    <span class="token keyword">return</span> peripherals<br>      <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'text'</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token function">radiusScale</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'tick-label-temperature'</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">'.0f'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">°F</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token function">setupDom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token function">createRadarChart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">'create radar chart'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>


<p><a href="/blog/">← Home</a></p>

    </main>

    <footer></footer>

    <!-- Current page: /blog/posts/june-14-2020/ -->
  </body>
</html>
