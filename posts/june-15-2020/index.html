<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>100 Days of Code - Day 32</title>
    <meta name="Description" content="TBDXXXXXXXXXX">
    <link rel="stylesheet" href="/blog/css/index.css">
    <link rel="stylesheet" href="/blog/css/prism-base16-monokai.dark.css">
    <link rel="alternate" href="/blog/feed/feed.xml" type="application/atom+xml" title="Dev Blog">
  </head>
  <body>
    <header>
      <h1 class="home"><a href="/blog/">Dev Blog</a></h1>
      <ul class="nav">
        <li class="nav-item"><a href="/blog/">Home</a></li>
        <li class="nav-item"><a href="/blog/posts/">Archive</a></li>
        <li class="nav-item"><a href="/blog/about/">About Me</a></li>
      </ul>
    </header>

    <main class="tmpl-post">

      <h1>100 Days of Code - Day 32</h1>

<h3 id="day-32%3A-june-15%2C-2020">Day 32: June 15, 2020 <a class="direct-link" href="#day-32%3A-june-15%2C-2020">#</a></h3>
<h4 id="today's-progress">Today's Progress <a class="direct-link" href="#today's-progress">#</a></h4>
<p>Today I finished a <a href="https://chrisvaillancourt.github.io/d3-examples/radar-weather-chart/">radar weather chart</a>.</p>
<h4 id="thoughts">Thoughts <a class="direct-link" href="#thoughts">#</a></h4>
<p>The radar chart is one of the more complex charts you can make. I have a new appreciation for the time it takes to build one and the time it takes to decipher visually.</p>
<p>I also used trigonometry for the first time since 10th grade so that was funny.</p>
<p>D3 tips:</p>
<ul>
<li>When choosing an area generator for a radar chart, use <a href="https://github.com/d3/d3-shape/blob/v1.3.7/README.md#areaRadial"><code>areaRadial()</code></a> instead of <a href="https://github.com/d3/d3-shape/blob/v1.3.7/README.md#area"><code>area()</code></a> because <code>area()</code> only accepts an x and y position (see <code>areaGenerator</code> below)</li>
<li>When scaling a circle's radius, use <a href="https://github.com/d3/d3-scale#scaleSqrt"><code>scaleSqrt()</code></a> instead of <a href="https://github.com/d3/d3-scale#scaleLinear"><code>scaleLinear()</code></a> to keep scale circle size</li>
</ul>
<h4 id="work-examples">Work examples <a class="direct-link" href="#work-examples">#</a></h4>
<p>Radar chart code:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> json <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'d3-fetch'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> select<span class="token punctuation">,</span> mouse <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'d3-selection'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> timeParse<span class="token punctuation">,</span> timeFormat <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'d3-time-format'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span><br>  scaleTime<span class="token punctuation">,</span><br>  scaleLinear<span class="token punctuation">,</span><br>  scaleSqrt<span class="token punctuation">,</span><br>  scaleOrdinal<span class="token punctuation">,</span><br>  scaleSequential<span class="token punctuation">,</span><br><span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'d3-scale'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> extent<span class="token punctuation">,</span> range <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'d3-array'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> timeMonths <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'d3-time'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> format <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'d3-format'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> areaRadial<span class="token punctuation">,</span> arc <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'d3-shape'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> interpolateYlOrRd <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'d3-scale-chromatic'</span><span class="token punctuation">;</span><br><br><br><span class="token keyword">function</span> <span class="token function">createDimensions</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> customDimensions <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token comment">// Used to create a dimensions data obj for creating chart dimensions.</span><br>  <span class="token comment">// Pass customDimesions to return an obj with extra key/value pairs.</span><br>  <span class="token keyword">return</span> <span class="token punctuation">{</span><br>    margin<span class="token operator">:</span> <span class="token punctuation">{</span><br>      top<span class="token operator">:</span> <span class="token number">120</span><span class="token punctuation">,</span><br>      right<span class="token operator">:</span> <span class="token number">120</span><span class="token punctuation">,</span><br>      bottom<span class="token operator">:</span> <span class="token number">120</span><span class="token punctuation">,</span><br>      left<span class="token operator">:</span> <span class="token number">120</span><span class="token punctuation">,</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token keyword">get</span> <span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">return</span> <span class="token punctuation">(</span><br>        <span class="token punctuation">(</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>innerWidth <span class="token operator">></span> <span class="token number">1500</span> <span class="token operator">?</span> <span class="token number">1500</span> <span class="token operator">:</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">)</span> <span class="token operator">-</span><br>          <span class="token keyword">this</span><span class="token punctuation">.</span>margin<span class="token punctuation">.</span>left <span class="token operator">-</span><br>          <span class="token keyword">this</span><span class="token punctuation">.</span>margin<span class="token punctuation">.</span>right<span class="token punctuation">)</span> <span class="token operator">*</span><br>        <span class="token number">0.75</span><br>      <span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token keyword">get</span> <span class="token function">boundedWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>width <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>margin<span class="token punctuation">.</span>left <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>margin<span class="token punctuation">.</span>right<span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token keyword">get</span> <span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>width<span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token keyword">get</span> <span class="token function">boundedHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>height <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>margin<span class="token punctuation">.</span>top <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>margin<span class="token punctuation">.</span>bottom<span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token keyword">get</span> <span class="token function">radius</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token keyword">get</span> <span class="token function">boundedRadius</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>radius <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>margin<span class="token punctuation">.</span>left <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>margin<span class="token punctuation">.</span>right<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token operator">...</span>customDimensions<span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">createRadarChart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token comment">// step 1) access data</span><br>  console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">'load data'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">json</span><span class="token punctuation">(</span><span class="token string">'../data/nyc_weather_data.json'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">'load data'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token comment">// console.table(data[0]);</span><br>  <span class="token keyword">function</span> <span class="token function">temperatureMinAccessor</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> d<span class="token punctuation">.</span>temperatureMin<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  <span class="token keyword">function</span> <span class="token function">temperatureMaxAccessor</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> d<span class="token punctuation">.</span>temperatureMax<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  <span class="token keyword">function</span> <span class="token function">uvAccessor</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> d<span class="token punctuation">.</span>uvIndex<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  <span class="token keyword">function</span> <span class="token function">precipitationProbabilityAccessor</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> d<span class="token punctuation">.</span>precipProbability<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  <span class="token keyword">function</span> <span class="token function">precipitationTypeAccessor</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> d<span class="token punctuation">.</span>precipType<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  <span class="token keyword">function</span> <span class="token function">cloudAccessor</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> d<span class="token punctuation">.</span>cloudCover<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  <span class="token keyword">var</span> dateParser <span class="token operator">=</span> <span class="token function">timeParse</span><span class="token punctuation">(</span><span class="token string">'%Y-%m-%d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">function</span> <span class="token function">dateAccessor</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> <span class="token function">dateParser</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>date<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token comment">// step 2) create chart dimensions</span><br>  <span class="token keyword">var</span> dimensions <span class="token operator">=</span> <span class="token function">createDimensions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token comment">// step 3) draw canvas</span><br>  <span class="token keyword">var</span> wrapper <span class="token operator">=</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'#wrapper'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'svg'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'width'</span><span class="token punctuation">,</span> dimensions<span class="token punctuation">.</span>width<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'height'</span><span class="token punctuation">,</span> dimensions<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// shift bounds to start in the center of the chart</span><br>  <span class="token comment">// This will be helpful when we decide where to place data and peripheral elements</span><br>  <span class="token comment">// We'll only need to know where they sit with respect to the center of the circle</span><br>  <span class="token keyword">var</span> bounds <span class="token operator">=</span> wrapper<br>    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'g'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><br>      <span class="token string">'transform'</span><span class="token punctuation">,</span><br>      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translate(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dimensions<span class="token punctuation">.</span>margin<span class="token punctuation">.</span>left <span class="token operator">+</span> dimensions<span class="token punctuation">.</span>boundedRadius<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><br>        dimensions<span class="token punctuation">.</span>margin<span class="token punctuation">.</span>top <span class="token operator">+</span> dimensions<span class="token punctuation">.</span>boundedRadius<br>      <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px)</span><span class="token template-punctuation string">`</span></span><br>    <span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> defs <span class="token operator">=</span> wrapper<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'defs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> gradientId <span class="token operator">=</span> <span class="token string">'temperature-gradient'</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> gradient <span class="token operator">=</span> defs<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'radialGradient'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span> gradientId<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> numberOfStops <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> gradientColorScale <span class="token operator">=</span> interpolateYlOrRd<span class="token punctuation">;</span><br><br>  <span class="token function">range</span><span class="token punctuation">(</span>numberOfStops<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    gradient<br>      <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'stop'</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'offset'</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">(</span>i <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>numberOfStops <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">%</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'stop-color'</span><span class="token punctuation">,</span> <span class="token function">gradientColorScale</span><span class="token punctuation">(</span>i <span class="token operator">/</span> <span class="token punctuation">(</span>numberOfStops <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// step 4) create scales</span><br>  <span class="token comment">// the location of a data element around the radar chart's center corresponds to its date</span><br>  <span class="token keyword">var</span> angleScale <span class="token operator">=</span> <span class="token function">scaleTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">domain</span><span class="token punctuation">(</span><span class="token function">extent</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> dateAccessor<span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// this is in radians</span><br>  <span class="token comment">// a circle has 2π radians</span><br>  <span class="token keyword">var</span> radiusScale <span class="token operator">=</span> <span class="token function">scaleLinear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">domain</span><span class="token punctuation">(</span><br>      <span class="token function">extent</span><span class="token punctuation">(</span><span class="token punctuation">[</span><br>        <span class="token operator">...</span>data<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>temperatureMaxAccessor<span class="token punctuation">)</span><span class="token punctuation">,</span><br>        <span class="token operator">...</span>data<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>temperatureMinAccessor<span class="token punctuation">)</span><span class="token punctuation">,</span><br>      <span class="token punctuation">]</span><span class="token punctuation">)</span><br>    <span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> dimensions<span class="token punctuation">.</span>boundedRadius<span class="token punctuation">]</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">nice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">function</span> <span class="token function">getXFromDataPoint</span><span class="token punctuation">(</span><span class="token parameter">d<span class="token punctuation">,</span> offset <span class="token operator">=</span> <span class="token number">1.4</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> <span class="token function">getCoordsForAngle</span><span class="token punctuation">(</span><span class="token function">angleScale</span><span class="token punctuation">(</span><span class="token function">dateAccessor</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> offset<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  <span class="token keyword">function</span> <span class="token function">getYFromDataPoint</span><span class="token punctuation">(</span><span class="token parameter">d<span class="token punctuation">,</span> offset <span class="token operator">=</span> <span class="token number">1.4</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> <span class="token function">getCoordsForAngle</span><span class="token punctuation">(</span><span class="token function">angleScale</span><span class="token punctuation">(</span><span class="token function">dateAccessor</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> offset<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  <span class="token keyword">var</span> cloudRadiusScale <span class="token operator">=</span> <span class="token function">scaleSqrt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">domain</span><span class="token punctuation">(</span><span class="token function">extent</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> cloudAccessor<span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> precipitationRadiusScale <span class="token operator">=</span> <span class="token function">scaleSqrt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">domain</span><span class="token punctuation">(</span><span class="token function">extent</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> precipitationProbabilityAccessor<span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> precipitationTypes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'rain'</span><span class="token punctuation">,</span> <span class="token string">'sleet'</span><span class="token punctuation">,</span> <span class="token string">'snow'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> precipitationTypeColorScale <span class="token operator">=</span> <span class="token function">scaleOrdinal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">domain</span><span class="token punctuation">(</span>precipitationTypes<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'#54a0ff'</span><span class="token punctuation">,</span> <span class="token string">'#636e72'</span><span class="token punctuation">,</span> <span class="token string">'#b2bec3'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token comment">// use scaleSequential instead of a linear scale so we can use our color scale as an</span><br>  <span class="token comment">// interpolator instead of specifying a range.</span><br>  <span class="token keyword">var</span> temperatureColorScale <span class="token operator">=</span> <span class="token function">scaleSequential</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">domain</span><span class="token punctuation">(</span><br>      <span class="token function">extent</span><span class="token punctuation">(</span><span class="token punctuation">[</span><br>        <span class="token operator">...</span>data<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>temperatureMaxAccessor<span class="token punctuation">)</span><span class="token punctuation">,</span><br>        <span class="token operator">...</span>data<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>temperatureMinAccessor<span class="token punctuation">)</span><span class="token punctuation">,</span><br>      <span class="token punctuation">]</span><span class="token punctuation">)</span><br>    <span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">interpolator</span><span class="token punctuation">(</span>gradientColorScale<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token comment">// step 5) draw peripherals</span><br>  <span class="token comment">// doing this before data drawing (typically step 5)</span><br>  <span class="token comment">// drawing peripherals first is helpful when we want to layer data elements on top of chart peripherals</span><br><br>  <span class="token keyword">var</span> peripherals <span class="token operator">=</span> bounds<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'g'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">function</span> <span class="token function">getCoordsForAngle</span><span class="token punctuation">(</span><span class="token parameter">angle<span class="token punctuation">,</span> offset <span class="token operator">=</span> <span class="token number">1</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// dimensions.boundedRadius * offset is the triangle's hypotenuse</span><br>    <span class="token comment">// we need to adjust the angle</span><br>    <span class="token comment">// because the radar chart starts in the center, above our origin point</span><br>    <span class="token keyword">return</span> <span class="token punctuation">[</span><br>      Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>angle <span class="token operator">-</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">*</span> dimensions<span class="token punctuation">.</span>boundedRadius <span class="token operator">*</span> offset<span class="token punctuation">,</span><br>      Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>angle <span class="token operator">-</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">*</span> dimensions<span class="token punctuation">.</span>boundedRadius <span class="token operator">*</span> offset<span class="token punctuation">,</span><br>    <span class="token punctuation">]</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  <span class="token comment">// create an array for each month in the data</span><br>  <span class="token comment">// d3 time intervals range() method will return a list of datetime objects</span><br>  <span class="token comment">// spaced by a specified interval</span><br>  <span class="token keyword">var</span> months <span class="token operator">=</span> <span class="token function">timeMonths</span><span class="token punctuation">(</span><span class="token operator">...</span>angleScale<span class="token punctuation">.</span><span class="token function">domain</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// same as timeMonth.range(...angleScale.domain())</span><br>  months<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">drawLinesForEachMonth</span><span class="token punctuation">(</span><span class="token parameter">month</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">var</span> angle <span class="token operator">=</span> <span class="token function">angleScale</span><span class="token punctuation">(</span>month<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">const</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">getCoordsForAngle</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token comment">// we don't need to specify x1/y1 because they default to 0</span><br>    peripherals<br>      <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'line'</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'x2'</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'y2'</span><span class="token punctuation">,</span> y<span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'grid-line'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">const</span> <span class="token punctuation">[</span>labelX<span class="token punctuation">,</span> labelY<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">getCoordsForAngle</span><span class="token punctuation">(</span>angle<span class="token punctuation">,</span> <span class="token number">1.38</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    peripherals<br>      <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'text'</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">,</span> labelX<span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">,</span> labelY<span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'tick-label'</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token function">timeFormat</span><span class="token punctuation">(</span><span class="token string">'%b'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>month<span class="token punctuation">)</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><br>        <span class="token string">'text-anchor'</span><span class="token punctuation">,</span><br>        <span class="token comment">// dynamically set value based on x position</span><br>        Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>labelX<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">5</span> <span class="token operator">?</span> <span class="token string">'middle'</span> <span class="token operator">:</span> labelX <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token string">'start'</span> <span class="token operator">:</span> <span class="token string">'end'</span><br>      <span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> temperatureTicks <span class="token operator">=</span> radiusScale<span class="token punctuation">.</span><span class="token function">ticks</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> gridCircles <span class="token operator">=</span> temperatureTicks<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">drawCircleGridLines</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> peripherals<br>      <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'circle'</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'r'</span><span class="token punctuation">,</span> <span class="token function">radiusScale</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'grid-line'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> tickLabelBackgrounds <span class="token operator">=</span> temperatureTicks<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>d<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span><br>    <span class="token keyword">return</span> peripherals<br>      <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'rect'</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token function">radiusScale</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">10</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'width'</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'height'</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'fill'</span><span class="token punctuation">,</span> <span class="token string">'#ffffff'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> tickLabels <span class="token operator">=</span> temperatureTicks<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>d<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span><br>    <span class="token keyword">return</span> peripherals<br>      <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'text'</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token function">radiusScale</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'tick-label-temperature'</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">'.0f'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">°F</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// step 6) draw data</span><br>  <span class="token keyword">const</span> freezingPoint <span class="token operator">=</span> <span class="token number">32</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> containsFreezing <span class="token operator">=</span> radiusScale<span class="token punctuation">.</span><span class="token function">domain</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> freezingPoint<span class="token punctuation">;</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>containsFreezing<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">const</span> freezingCircle <span class="token operator">=</span> bounds<br>      <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'circle'</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'r'</span><span class="token punctuation">,</span> <span class="token function">radiusScale</span><span class="token punctuation">(</span>freezingPoint<span class="token punctuation">)</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'freezing-circle'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  <span class="token comment">// areaGenerator returns the d attribute string for a &lt;path> element</span><br>  <span class="token keyword">var</span> areaGenerator <span class="token operator">=</span> <span class="token function">areaRadial</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">angle</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">return</span> <span class="token function">angleScale</span><span class="token punctuation">(</span><span class="token function">dateAccessor</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">innerRadius</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">getMinTempPosition</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">return</span> <span class="token function">radiusScale</span><span class="token punctuation">(</span><span class="token function">temperatureMinAccessor</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">outerRadius</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">getMaxTempPosition</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">return</span> <span class="token function">radiusScale</span><span class="token punctuation">(</span><span class="token function">temperatureMaxAccessor</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token comment">// create path element and set d attribute</span><br>  <span class="token keyword">var</span> area <span class="token operator">=</span> bounds<br>    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><br>    <span class="token comment">// .attr('class', 'area')</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'d'</span><span class="token punctuation">,</span> <span class="token function">areaGenerator</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'fill'</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">url(#</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>gradientId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> uvIndexThreshold <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span><br>  <span class="token comment">// offset UV lines to a point just inside the edges of the radius</span><br>  <span class="token keyword">const</span> uvOffset <span class="token operator">=</span> <span class="token number">0.95</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> uvGroup <span class="token operator">=</span> bounds<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'g'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> uvCoordinateOffset <span class="token operator">=</span> <span class="token number">0.1</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> highUvDays <span class="token operator">=</span> uvGroup<br>    <span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token string">'line'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><br>      data<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">getDaysAboveUvThreshold</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">return</span> <span class="token function">uvAccessor</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span> <span class="token operator">></span> uvIndexThreshold<span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><span class="token punctuation">)</span><br>    <span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">enter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'line'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'uv-line'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'x1'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">getXFromDataPoint</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span> uvOffset<span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'x2'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">getXFromDataPoint</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span> uvOffset <span class="token operator">+</span> uvCoordinateOffset<span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'y1'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">getYFromDataPoint</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span> uvOffset<span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'y2'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">getYFromDataPoint</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span> uvOffset <span class="token operator">+</span> uvCoordinateOffset<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">var</span> cloudGroup <span class="token operator">=</span> bounds<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'g'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> cloudOffset <span class="token operator">=</span> <span class="token number">1.27</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> cloudDots <span class="token operator">=</span> cloudGroup<br>    <span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token string">'circle'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">enter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'circle'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'cloud-dot'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'cx'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">getCloudCircleX</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">return</span> <span class="token function">getXFromDataPoint</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span> cloudOffset<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'cy'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">getCloudCircleY</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">return</span> <span class="token function">getYFromDataPoint</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span> cloudOffset<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'r'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">getCloudCircleR</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">return</span> <span class="token function">cloudRadiusScale</span><span class="token punctuation">(</span><span class="token function">cloudAccessor</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> precipitationGroup <span class="token operator">=</span> bounds<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'g'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> precipitationOffset <span class="token operator">=</span> <span class="token number">1.14</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> precipitationDots <span class="token operator">=</span> precipitationGroup<br>    <span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token string">'circle'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>precipitationTypeAccessor<span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">enter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'circle'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'precipitation-dot'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'cx'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">getPrecipCircleX</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">return</span> <span class="token function">getXFromDataPoint</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span> precipitationOffset<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'cy'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">getPrecipCircleY</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">return</span> <span class="token function">getYFromDataPoint</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span> precipitationOffset<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'r'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">getRadiusFromPrecipType</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">return</span> <span class="token function">precipitationRadiusScale</span><span class="token punctuation">(</span><span class="token function">precipitationProbabilityAccessor</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">'fill'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">getColorFromPrecipType</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">return</span> <span class="token function">precipitationTypeColorScale</span><span class="token punctuation">(</span><span class="token function">precipitationTypeAccessor</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> annotationGroup <span class="token operator">=</span> bounds<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'g'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">function</span> <span class="token function">drawAnnotation</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> angle<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> text<span class="token punctuation">,</span> annotationGrp <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// draw lines 1.6 times our circle's radius</span><br>    <span class="token keyword">const</span> lineOffset <span class="token operator">=</span> <span class="token number">1.6</span><span class="token punctuation">;</span><br>    <span class="token keyword">const</span> textXCoordOffset <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span><br>    <span class="token keyword">const</span> <span class="token punctuation">[</span>x1<span class="token punctuation">,</span> y1<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">getCoordsForAngle</span><span class="token punctuation">(</span>angle<span class="token punctuation">,</span> offset<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">const</span> <span class="token punctuation">[</span>x2<span class="token punctuation">,</span> y2<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">getCoordsForAngle</span><span class="token punctuation">(</span>angle<span class="token punctuation">,</span> lineOffset<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    annotationGrp<br>      <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'line'</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'annotation-line'</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'x1'</span><span class="token punctuation">,</span> x1<span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'x2'</span><span class="token punctuation">,</span> x2<span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'y1'</span><span class="token punctuation">,</span> y1<span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'y2'</span><span class="token punctuation">,</span> y2<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    annotationGrp<br>      <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'text'</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'annotation-text'</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">,</span> x2 <span class="token operator">+</span> textXCoordOffset<span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">,</span> y2<span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  <span class="token comment">// set angle (in radians) of annotations around the center of the chart</span><br>  <span class="token comment">// a circle has 2pie radians in one full rotation</span><br>  <span class="token keyword">const</span> cloudCoverAnnotationAngle <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">0.23</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> precipitationAnnotationAngle <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">0.26</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> uvIndexThresholdAnnotationAngle <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">0.734</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> uvIndexThresholdAnnotationOffset <span class="token operator">=</span> uvOffset <span class="token operator">+</span> <span class="token number">0.05</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> uvAnnotationText <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">UV Index over </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>uvIndexThreshold<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> tempAnnotationAngle <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">0.7</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> tempAnnotationOffset <span class="token operator">=</span> <span class="token number">0.5</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> freezingTempAnnotationAngle <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">0.9</span><span class="token punctuation">;</span><br>  <span class="token comment">// have to convert freezing point into a value relative to our bounded radius since</span><br>  <span class="token comment">// drawAnnotation() takes an offset instead of a radius value</span><br>  <span class="token keyword">const</span> freezingTempOffset <span class="token operator">=</span><br>    <span class="token function">radiusScale</span><span class="token punctuation">(</span>freezingPoint<span class="token punctuation">)</span> <span class="token operator">/</span> dimensions<span class="token punctuation">.</span>boundedRadius<span class="token punctuation">;</span><br><br>  <span class="token function">drawAnnotation</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>    angle<span class="token operator">:</span> cloudCoverAnnotationAngle<span class="token punctuation">,</span><br>    offset<span class="token operator">:</span> cloudOffset<span class="token punctuation">,</span><br>    text<span class="token operator">:</span> <span class="token string">'Cloud Cover'</span><span class="token punctuation">,</span><br>    annotationGrp<span class="token operator">:</span> annotationGroup<span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token function">drawAnnotation</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>    angle<span class="token operator">:</span> precipitationAnnotationAngle<span class="token punctuation">,</span><br>    offset<span class="token operator">:</span> precipitationOffset<span class="token punctuation">,</span><br>    text<span class="token operator">:</span> <span class="token string">'Precipitation'</span><span class="token punctuation">,</span><br>    annotationGrp<span class="token operator">:</span> annotationGroup<span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token function">drawAnnotation</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>    angle<span class="token operator">:</span> uvIndexThresholdAnnotationAngle<span class="token punctuation">,</span><br>    offset<span class="token operator">:</span> uvIndexThresholdAnnotationOffset<span class="token punctuation">,</span><br>    text<span class="token operator">:</span> uvAnnotationText<span class="token punctuation">,</span><br>    annotationGrp<span class="token operator">:</span> annotationGroup<span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token function">drawAnnotation</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>    angle<span class="token operator">:</span> tempAnnotationAngle<span class="token punctuation">,</span><br>    offset<span class="token operator">:</span> tempAnnotationOffset<span class="token punctuation">,</span><br>    text<span class="token operator">:</span> <span class="token string">'Temperature'</span><span class="token punctuation">,</span><br>    annotationGrp<span class="token operator">:</span> annotationGroup<span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>containsFreezing<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token function">drawAnnotation</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>      angle<span class="token operator">:</span> freezingTempAnnotationAngle<span class="token punctuation">,</span><br>      offset<span class="token operator">:</span> freezingTempOffset<span class="token punctuation">,</span><br>      text<span class="token operator">:</span> <span class="token string">'Freezing Temperatures'</span><span class="token punctuation">,</span><br>      annotationGrp<span class="token operator">:</span> annotationGroup<span class="token punctuation">,</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  <span class="token comment">// create precipitation color legend</span><br>  <span class="token keyword">const</span> precipLabelAngle <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">0.26</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> precipLabelCoordOffset <span class="token operator">=</span> <span class="token number">1.6</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> precipCircleXOffset <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> <span class="token function-variable function">precipAnnotationYOffset</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">index</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token number">16</span> <span class="token operator">*</span> <span class="token punctuation">(</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> <span class="token punctuation">[</span>precipLabelXCoord<span class="token punctuation">,</span> precipLabelYCoord<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">getCoordsForAngle</span><span class="token punctuation">(</span><br>    precipLabelAngle<span class="token punctuation">,</span><br>    precipLabelCoordOffset<br>  <span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> precipLabelTextXOffset <span class="token operator">=</span> <span class="token number">25</span><span class="token punctuation">;</span><br><br>  precipitationTypes<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">precipitationType<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    annotationGroup<br>      <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'circle'</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'cx'</span><span class="token punctuation">,</span> precipLabelXCoord <span class="token operator">+</span> precipCircleXOffset<span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'cy'</span><span class="token punctuation">,</span> precipLabelYCoord <span class="token operator">+</span> <span class="token function">precipAnnotationYOffset</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'r'</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">'opacity'</span><span class="token punctuation">,</span> <span class="token number">0.7</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'fill'</span><span class="token punctuation">,</span> <span class="token function">precipitationTypeColorScale</span><span class="token punctuation">(</span>precipitationType<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    annotationGroup<br>      <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'text'</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'annotation-text'</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">,</span> precipLabelXCoord <span class="token operator">+</span> precipLabelTextXOffset<span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">,</span> precipLabelYCoord <span class="token operator">+</span> <span class="token function">precipAnnotationYOffset</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span>precipitationType<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token comment">// step 7) set-up interactions</span><br>  <span class="token keyword">var</span> tooltip <span class="token operator">=</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'#tooltip'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> tooltipTemperatureMin <span class="token operator">=</span> tooltip<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'#tooltip-temperature-min'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> tooltipTemperatureMax <span class="token operator">=</span> tooltip<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'#tooltip-temperature-max'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> tooltipUv <span class="token operator">=</span> tooltip<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'#tooltip-uv'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> tooltipCloud <span class="token operator">=</span> tooltip<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'#tooltip-cloud'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> tooltipPrecipitation <span class="token operator">=</span> tooltip<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'#tooltip-precipitation'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> tooltipPrecipitationType <span class="token operator">=</span> tooltip<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'#tooltip-precipitation-type'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> tooltipPrecipitationLabel <span class="token operator">=</span> tooltip<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'.tooltip-precipitation-type'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">var</span> tooltipLine <span class="token operator">=</span> bounds<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'tooltip-line'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">var</span> listenerCircle <span class="token operator">=</span> bounds<br>    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'circle'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'listener-circle'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'r'</span><span class="token punctuation">,</span> dimensions<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'mousemove'</span><span class="token punctuation">,</span> handleMouseMove<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'mouseleave'</span><span class="token punctuation">,</span> handleMouseLeave<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">function</span> <span class="token function">handleMouseMove</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">const</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">mouse</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token comment">// rotate angle back 1/4 turn to match date scale</span><br>    <span class="token keyword">var</span> angle <span class="token operator">=</span> <span class="token function">getAngleFromCoordinates</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>angle <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token comment">// rotate any negative angles around the circle one full turn so they fit on the angleScale</span><br>      angle <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">+</span> angle<span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>    <span class="token comment">// We want to draw a line to highlight the date currently hovered</span><br>    <span class="token comment">// but it needs to increase in width as it gets farther from the center.</span><br>    <span class="token comment">// Use arc() to create this shape.</span><br>    <span class="token comment">// innerRadius and outerRadius tell the generator how long we'd like the arc to be</span><br>    <span class="token comment">// startAngle and endAngle tell it how wide it should be</span><br>    <span class="token keyword">var</span> tooltipArcGenerator <span class="token operator">=</span> <span class="token function">arc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">innerRadius</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">outerRadius</span><span class="token punctuation">(</span>dimensions<span class="token punctuation">.</span>boundedRadius <span class="token operator">*</span> <span class="token number">1.6</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">startAngle</span><span class="token punctuation">(</span>angle <span class="token operator">-</span> <span class="token number">0.015</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">endAngle</span><span class="token punctuation">(</span>angle <span class="token operator">+</span> <span class="token number">0.015</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    tooltipLine<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'d'</span><span class="token punctuation">,</span> <span class="token function">tooltipArcGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">'opacity'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token comment">// get coordinates of the point at the end of the line</span><br>    <span class="token keyword">var</span> <span class="token punctuation">[</span>outerCoordinateX<span class="token punctuation">,</span> outerCoordinateY<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">getCoordsForAngle</span><span class="token punctuation">(</span>angle<span class="token punctuation">,</span> <span class="token number">1.6</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// use calc() to choose which side of the tooltip to anchor to outerCoordinates</span><br>    tooltip<span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">'opacity'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><br>      <span class="token string">'transform'</span><span class="token punctuation">,</span><br>      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translate(<br>        calc(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><br>          outerCoordinateX <span class="token operator">&lt;</span> <span class="token operator">-</span><span class="token number">50</span><br>            <span class="token operator">?</span> <span class="token string">'40px - 100'</span><br>            <span class="token operator">:</span> outerCoordinateX <span class="token operator">></span> <span class="token number">50</span><br>            <span class="token operator">?</span> <span class="token string">'-40px + 0'</span><br>            <span class="token operator">:</span> <span class="token string">'-50'</span><br>        <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">%<br>        + </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><br>          outerCoordinateX <span class="token operator">+</span> dimensions<span class="token punctuation">.</span>margin<span class="token punctuation">.</span>top <span class="token operator">+</span> dimensions<span class="token punctuation">.</span>boundedRadius<br>        <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px),<br>        calc(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><br>          outerCoordinateY <span class="token operator">&lt;</span> <span class="token operator">-</span><span class="token number">50</span><br>            <span class="token operator">?</span> <span class="token string">'40px - 100'</span><br>            <span class="token operator">:</span> outerCoordinateY <span class="token operator">></span> <span class="token number">50</span><br>            <span class="token operator">?</span> <span class="token string">'-40px + 0'</span><br>            <span class="token operator">:</span> <span class="token string">'-50'</span><br>        <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">% + </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><br>        outerCoordinateY <span class="token operator">+</span> dimensions<span class="token punctuation">.</span>margin<span class="token punctuation">.</span>top <span class="token operator">+</span> dimensions<span class="token punctuation">.</span>boundedRadius<br>      <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px)<br>      )</span><span class="token template-punctuation string">`</span></span><br>    <span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token comment">// .invert() converts range the dimension (angle) to it's domain dimension (date)</span><br>    <span class="token keyword">var</span> date <span class="token operator">=</span> angleScale<span class="token punctuation">.</span><span class="token function">invert</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token comment">// format the date the same as our dataset and get the date with the same date string</span><br>    <span class="token keyword">var</span> dateString <span class="token operator">=</span> <span class="token function">timeFormat</span><span class="token punctuation">(</span><span class="token string">'%Y-%m-%d'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">var</span> dataPoint <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">getMatchingData</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">return</span> d<span class="token punctuation">.</span>date <span class="token operator">==</span> dateString<span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>dataPoint<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span><br>    tooltipTemperatureMin<span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><br>      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">'.1f'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">temperatureMinAccessor</span><span class="token punctuation">(</span>dataPoint<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">°F</span><span class="token template-punctuation string">`</span></span><br>    <span class="token punctuation">)</span><span class="token punctuation">;</span><br>    tooltipTemperatureMax<span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><br>      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">'.1f'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">temperatureMaxAccessor</span><span class="token punctuation">(</span>dataPoint<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">°F</span><span class="token template-punctuation string">`</span></span><br>    <span class="token punctuation">)</span><span class="token punctuation">;</span><br>    tooltipUv<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token function">uvAccessor</span><span class="token punctuation">(</span>dataPoint<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    tooltipCloud<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token function">cloudAccessor</span><span class="token punctuation">(</span>dataPoint<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    tooltipPrecipitation<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><br>      <span class="token function">format</span><span class="token punctuation">(</span><span class="token string">'.0%'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">precipitationProbabilityAccessor</span><span class="token punctuation">(</span>dataPoint<span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">)</span><span class="token punctuation">;</span><br>    tooltipPrecipitationType<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token function">precipitationTypeAccessor</span><span class="token punctuation">(</span>dataPoint<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    tooltipPrecipitationLabel<span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><br>      <span class="token string">'color'</span><span class="token punctuation">,</span><br>      <span class="token function">precipitationTypeAccessor</span><span class="token punctuation">(</span>dataPoint<span class="token punctuation">)</span><br>        <span class="token operator">?</span> <span class="token function">precipitationTypeColorScale</span><span class="token punctuation">(</span><span class="token function">precipitationTypeAccessor</span><span class="token punctuation">(</span>dataPoint<span class="token punctuation">)</span><span class="token punctuation">)</span><br>        <span class="token operator">:</span> <span class="token string">'#dadadd'</span><br>    <span class="token punctuation">)</span><span class="token punctuation">;</span><br>    tooltipTemperatureMin<span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><br>      <span class="token string">'color'</span><span class="token punctuation">,</span><br>      <span class="token function">temperatureColorScale</span><span class="token punctuation">(</span><span class="token function">temperatureMinAccessor</span><span class="token punctuation">(</span>dataPoint<span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">)</span><span class="token punctuation">;</span><br>    tooltipTemperatureMax<span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><br>      <span class="token string">'color'</span><span class="token punctuation">,</span><br>      <span class="token function">temperatureColorScale</span><span class="token punctuation">(</span><span class="token function">temperatureMaxAccessor</span><span class="token punctuation">(</span>dataPoint<span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  <span class="token keyword">function</span> <span class="token function">handleMouseLeave</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    tooltipLine<span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">'opacity'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    tooltip<span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">'opacity'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  <span class="token keyword">function</span> <span class="token function">getAngleFromCoordinates</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">atan2</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br>console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">'create radar chart'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token function">createRadarChart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">'create radar chart'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>


<p><a href="/blog/">← Home</a></p>

    </main>

    <footer></footer>

    <!-- Current page: /blog/posts/june-15-2020/ -->
  </body>
</html>
