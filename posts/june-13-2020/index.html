<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>100 Days of Code - Day 30</title>
    <meta name="Description" content="D3 Marginal Histogram">
    <link rel="stylesheet" href="/blog/css/index.css">
    <link rel="stylesheet" href="/blog/css/prism-base16-monokai.dark.css">
    <link rel="alternate" href="/blog/feed/feed.xml" type="application/atom+xml" title="Dev Blog">
  </head>
  <body>
    <header>
      <h1 class="home"><a href="/blog/">Dev Blog</a></h1>
      <ul class="nav">
        <li class="nav-item"><a href="/blog/">Home</a></li>
        <li class="nav-item"><a href="/blog/posts/">Archive</a></li>
        <li class="nav-item"><a href="/blog/about/">About Me</a></li>
      </ul>
    </header>

    <main class="tmpl-post">

      <h1>100 Days of Code - Day 30</h1>

<h3 id="day-30%3A-june-13%2C-2020">Day 30: June 13, 2020 <a class="direct-link" href="#day-30%3A-june-13%2C-2020">#</a></h3>
<h4 id="today's-progress">Today's Progress <a class="direct-link" href="#today's-progress">#</a></h4>
<p>Today I worked on this <a href="https://chrisvaillancourt.github.io/d3-examples/marginal-histogram/">d3 marginal histogram</a>.</p>
<h4 id="thoughts">Thoughts <a class="direct-link" href="#thoughts">#</a></h4>
<p>The more I read D3 code, the easier it gets. The declarative nature of D3 makes it enjoyable to write, even if it's verbose.</p>
<h4 id="work-examples">Work examples <a class="direct-link" href="#work-examples">#</a></h4>
<p>Marginal histogram code:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> json <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'d3-fetch'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> min<span class="token punctuation">,</span> extent<span class="token punctuation">,</span> histogram<span class="token punctuation">,</span> range<span class="token punctuation">,</span> median <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'d3-array'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> select<span class="token punctuation">,</span> selectAll<span class="token punctuation">,</span> mouse <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'d3-selection'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> scaleLinear<span class="token punctuation">,</span> scaleSequential <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'d3-scale'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> axisBottom<span class="token punctuation">,</span> axisLeft <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'d3-axis'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> format <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'d3-format'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> Delaunay <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'d3-delaunay'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> timeFormat<span class="token punctuation">,</span> timeParse <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'d3-time-format'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> interpolateRainbow <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'d3-scale-chromatic'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> area<span class="token punctuation">,</span> curveBasis <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'d3-shape'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> drawHistogram <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../utils/drawHistogram'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> createDimensions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../utils/createDimensions'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> transition <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'d3-transition'</span><span class="token punctuation">;</span><br><br><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">drawScatter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token comment">// 1. Access data</span><br><br>  <span class="token keyword">const</span> dataset <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">json</span><span class="token punctuation">(</span><span class="token string">'../data/nyc_weather_data.json'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">function</span> <span class="token function">xAccessor</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> d<span class="token punctuation">.</span>temperatureMin<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  <span class="token keyword">function</span> <span class="token function">yAccessor</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> d<span class="token punctuation">.</span>temperatureMax<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  <span class="token comment">// use a standard date to normalize our data with.</span><br>  <span class="token comment">// We'll do this in-case our data spans multiple years</span><br>  <span class="token comment">// allowing us to color the dots by the day/month</span><br>  <span class="token keyword">const</span> colorScaleYear <span class="token operator">=</span> <span class="token number">2000</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> parseDate <span class="token operator">=</span> <span class="token function">timeParse</span><span class="token punctuation">(</span><span class="token string">'%Y-%m-%d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">function</span> <span class="token function">colorAccessor</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> <span class="token function">parseDate</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>date<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setYear</span><span class="token punctuation">(</span>colorScaleYear<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  <span class="token comment">// 2. Create chart dimensions</span><br>  <span class="token keyword">var</span> dimensions <span class="token operator">=</span> <span class="token function">createDimensions</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>    customDimensions<span class="token operator">:</span> <span class="token punctuation">{</span><br>      histogramMargin<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span><br>      histogramHeight<span class="token operator">:</span> <span class="token number">70</span><span class="token punctuation">,</span><br>      legendWidth<span class="token operator">:</span> <span class="token number">250</span><span class="token punctuation">,</span><br>      legendHeight<span class="token operator">:</span> <span class="token number">26</span><span class="token punctuation">,</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// 3. Draw canvas</span><br><br>  <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'#wrapper'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'svg'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'width'</span><span class="token punctuation">,</span> dimensions<span class="token punctuation">.</span>width<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'height'</span><span class="token punctuation">,</span> dimensions<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">const</span> bounds <span class="token operator">=</span> wrapper<br>    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'g'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><br>      <span class="token string">'transform'</span><span class="token punctuation">,</span><br>      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translate(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dimensions<span class="token punctuation">.</span>margin<span class="token punctuation">.</span>left<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dimensions<span class="token punctuation">.</span>margin<span class="token punctuation">.</span>top<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px)</span><span class="token template-punctuation string">`</span></span><br>    <span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> boundsBackground <span class="token operator">=</span> bounds<br>    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'rect'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">classed</span><span class="token punctuation">(</span><span class="token string">'bounds-background'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'width'</span><span class="token punctuation">,</span> dimensions<span class="token punctuation">.</span>boundedWidth<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'height'</span><span class="token punctuation">,</span> dimensions<span class="token punctuation">.</span>boundedHeight<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// 4. Create scales</span><br><br>  <span class="token comment">// find the smallest min temp and largest max temp</span><br>  <span class="token comment">// we'll use the extent as the domain for both x &amp; y axis</span><br>  <span class="token keyword">var</span> tempsExtent <span class="token operator">=</span> <span class="token function">extent</span><span class="token punctuation">(</span><span class="token punctuation">[</span><br>    <span class="token operator">...</span>dataset<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>xAccessor<span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token operator">...</span>dataset<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>yAccessor<span class="token punctuation">)</span><span class="token punctuation">,</span><br>  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">const</span> xScale <span class="token operator">=</span> <span class="token function">scaleLinear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">domain</span><span class="token punctuation">(</span>tempsExtent<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> dimensions<span class="token punctuation">.</span>boundedWidth<span class="token punctuation">]</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">nice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">const</span> yScale <span class="token operator">=</span> <span class="token function">scaleLinear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">domain</span><span class="token punctuation">(</span>tempsExtent<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token punctuation">[</span>dimensions<span class="token punctuation">.</span>boundedHeight<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">nice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token comment">// use a sequential scale to cover the entire year</span><br><br>  <span class="token keyword">var</span> colorScale <span class="token operator">=</span> <span class="token function">scaleSequential</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">domain</span><span class="token punctuation">(</span><span class="token punctuation">[</span><br>      <span class="token function">timeParse</span><span class="token punctuation">(</span><span class="token string">'%m/%d/%Y'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">1/1/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>colorScaleYear<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>      <span class="token function">timeParse</span><span class="token punctuation">(</span><span class="token string">'%m/%d/%Y'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">12/31/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>colorScaleYear<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token punctuation">]</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">interpolator</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">invertDate</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token comment">// flip the value to better correspond with season colors</span><br>      <span class="token keyword">return</span> <span class="token function">interpolateRainbow</span><span class="token punctuation">(</span><span class="token operator">-</span>d<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><br>  <span class="token comment">// 5. Draw data</span><br>  <span class="token keyword">var</span> dotsGroup <span class="token operator">=</span> bounds<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'g'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> dots <span class="token operator">=</span> dotsGroup<br>    <span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token string">'.dot'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>dataset<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> d<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'circle'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'dot'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'cx'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">xScale</span><span class="token punctuation">(</span><span class="token function">xAccessor</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'cy'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">yScale</span><span class="token punctuation">(</span><span class="token function">yAccessor</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'r'</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">'fill'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">setFill</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">return</span> <span class="token function">colorScale</span><span class="token punctuation">(</span><span class="token function">colorAccessor</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token function">drawHistogram</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>    data<span class="token operator">:</span> dataset<span class="token punctuation">,</span><br>    scale<span class="token operator">:</span> yScale<span class="token punctuation">,</span><br>    accessor<span class="token operator">:</span> yAccessor<span class="token punctuation">,</span><br>    chartBounds<span class="token operator">:</span> bounds<span class="token punctuation">,</span><br>    dimensions<span class="token punctuation">,</span><br>    histogramClass<span class="token operator">:</span> <span class="token string">'right-histogram'</span><span class="token punctuation">,</span><br>    pathClass<span class="token operator">:</span> <span class="token string">'histogram-area'</span><span class="token punctuation">,</span><br>    chartTransform<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translate(<br>        </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dimensions<span class="token punctuation">.</span>boundedWidth <span class="token operator">+</span> dimensions<span class="token punctuation">.</span>histogramMargin<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px, -</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><br>      dimensions<span class="token punctuation">.</span>histogramHeight<br>    <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px) rotate(90deg)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token function">drawHistogram</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>    data<span class="token operator">:</span> dataset<span class="token punctuation">,</span><br>    scale<span class="token operator">:</span> xScale<span class="token punctuation">,</span><br>    accessor<span class="token operator">:</span> xAccessor<span class="token punctuation">,</span><br>    chartBounds<span class="token operator">:</span> bounds<span class="token punctuation">,</span><br>    dimensions<span class="token punctuation">,</span><br>    histogramClass<span class="token operator">:</span> <span class="token string">'top-histogram'</span><span class="token punctuation">,</span><br>    pathClass<span class="token operator">:</span> <span class="token string">'histogram-area'</span><span class="token punctuation">,</span><br>    chartTransform<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translate(0px, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><br>      <span class="token operator">-</span>dimensions<span class="token punctuation">.</span>histogramHeight <span class="token operator">-</span> dimensions<span class="token punctuation">.</span>histogramMargin<br>    <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token comment">// create a new Delaunay triangulation for interaction</span><br>  <span class="token keyword">var</span> delaunay <span class="token operator">=</span> Delaunay<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><br>    dataset<span class="token punctuation">,</span><br>    <span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">xScale</span><span class="token punctuation">(</span><span class="token function">xAccessor</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">yScale</span><span class="token punctuation">(</span><span class="token function">yAccessor</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><br>  <span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// turn the delaunay triangulation into a voronoi diagram</span><br>  <span class="token keyword">var</span> voronoi <span class="token operator">=</span> delaunay<span class="token punctuation">.</span><span class="token function">voronoi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// specify bounds size</span><br>  voronoi<span class="token punctuation">.</span>xmax <span class="token operator">=</span> dimensions<span class="token punctuation">.</span>boundedWidth<span class="token punctuation">;</span><br>  voronoi<span class="token punctuation">.</span>ymax <span class="token operator">=</span> dimensions<span class="token punctuation">.</span>boundedHeight<span class="token punctuation">;</span><br><br>  bounds<br>    <span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token string">'.voronoi'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>dataset<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">enter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'voronoi'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'d'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">createPath</span><span class="token punctuation">(</span><span class="token parameter">d<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token comment">// create each path's d attribute string by passing voronoi.randerCell() the index</span><br>      <span class="token comment">// of our data point</span><br>      <span class="token keyword">return</span> voronoi<span class="token punctuation">.</span><span class="token function">renderCell</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// 6. Draw peripherals</span><br><br>  <span class="token keyword">const</span> xAxisGenerator <span class="token operator">=</span> <span class="token function">axisBottom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">scale</span><span class="token punctuation">(</span>xScale<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">const</span> xAxis <span class="token operator">=</span> bounds<br>    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'g'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>xAxisGenerator<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">'transform'</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translateY(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dimensions<span class="token punctuation">.</span>boundedHeight<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">const</span> xAxisLabel <span class="token operator">=</span> xAxis<br>    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'text'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'x-axis-label'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">,</span> dimensions<span class="token punctuation">.</span>boundedWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">,</span> dimensions<span class="token punctuation">.</span>margin<span class="token punctuation">.</span>bottom <span class="token operator">-</span> <span class="token number">10</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">'Minimum Temperature (&amp;deg;F)'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">const</span> yAxisGenerator <span class="token operator">=</span> <span class="token function">axisLeft</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">scale</span><span class="token punctuation">(</span>yScale<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ticks</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">const</span> yAxis <span class="token operator">=</span> bounds<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'g'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>yAxisGenerator<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">const</span> yAxisLabel <span class="token operator">=</span> yAxis<br>    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'text'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'y-axis-label'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">,</span> <span class="token operator">-</span>dimensions<span class="token punctuation">.</span>boundedHeight <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token operator">-</span>dimensions<span class="token punctuation">.</span>margin<span class="token punctuation">.</span>left <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">'Maximum Temperature (&amp;deg;F)'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">var</span> legendGroup <span class="token operator">=</span> bounds<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'g'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><br>    <span class="token string">'transform'</span><span class="token punctuation">,</span><br>    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translate(<br>      </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dimensions<span class="token punctuation">.</span>boundedWidth <span class="token operator">-</span> dimensions<span class="token punctuation">.</span>legendWidth <span class="token operator">-</span> <span class="token number">9</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,<br>      </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dimensions<span class="token punctuation">.</span>boundedHeight <span class="token operator">-</span> <span class="token number">37</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><br>  <span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">var</span> defs <span class="token operator">=</span> wrapper<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'defs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> numberOfGradientStops <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span><br>  <span class="token comment">// create an array of desired number of stops and normalize indices to go up to 1;</span><br>  <span class="token keyword">var</span> stops <span class="token operator">=</span> <span class="token function">range</span><span class="token punctuation">(</span>numberOfGradientStops<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><br>    <span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span> <span class="token operator">=></span> i <span class="token operator">/</span> <span class="token punctuation">(</span>numberOfGradientStops <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><br>  <span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> legendGradientId <span class="token operator">=</span> <span class="token string">'legend-gradient'</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> gradient <span class="token operator">=</span> defs<br>    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'linearGradient'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span> legendGradientId<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token string">'stop'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>stops<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">enter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'stop'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'stop-color'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">interpolateRainbow</span><span class="token punctuation">(</span><span class="token operator">-</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'offset'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>d <span class="token operator">*</span> <span class="token number">100</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">%</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">var</span> legendGradient <span class="token operator">=</span> legendGroup<br>    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'rect'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'height'</span><span class="token punctuation">,</span> dimensions<span class="token punctuation">.</span>legendHeight<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'width'</span><span class="token punctuation">,</span> dimensions<span class="token punctuation">.</span>legendWidth<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">'fill'</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">url(#</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>legendGradientId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// create an array of key dates</span><br>  <span class="token keyword">var</span> tickValues <span class="token operator">=</span> <span class="token punctuation">[</span><br>    <span class="token function">timeParse</span><span class="token punctuation">(</span><span class="token string">'%m/%d/%Y'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">4/1/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>colorScaleYear<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token function">timeParse</span><span class="token punctuation">(</span><span class="token string">'%m/%d/%Y'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">7/1/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>colorScaleYear<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token function">timeParse</span><span class="token punctuation">(</span><span class="token string">'%m/%d/%Y'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">10/1/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>colorScaleYear<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>  <span class="token punctuation">]</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">var</span> legendTickScale <span class="token operator">=</span> <span class="token function">scaleLinear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">domain</span><span class="token punctuation">(</span>colorScale<span class="token punctuation">.</span><span class="token function">domain</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> dimensions<span class="token punctuation">.</span>legendWidth<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">var</span> legendValues <span class="token operator">=</span> legendGroup<br>    <span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token string">'.legend-value'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>tickValues<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">enter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'text'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'legend-value'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">,</span> legendTickScale<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token function">timeFormat</span><span class="token punctuation">(</span><span class="token string">'%b'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">var</span> legendValueTicks <span class="token operator">=</span> legendGroup<br>    <span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token string">'.legend-tick'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>tickValues<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">enter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'line'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'legend-tick'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'x1'</span><span class="token punctuation">,</span> legendTickScale<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'x2'</span><span class="token punctuation">,</span> legendTickScale<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'y1'</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// 7. Set up interactions</span><br>  <span class="token keyword">var</span> tooltip <span class="token operator">=</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'#tooltip'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> formatMetric <span class="token operator">=</span> <span class="token function">format</span><span class="token punctuation">(</span><span class="token string">'.2f'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> dateParser <span class="token operator">=</span> <span class="token function">timeParse</span><span class="token punctuation">(</span><span class="token string">'%Y-%m-%d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> formatDate <span class="token operator">=</span> <span class="token function">timeFormat</span><span class="token punctuation">(</span><span class="token string">'%B %A %-d, %Y'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">var</span> hoverElementsGroup <span class="token operator">=</span> bounds<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'g'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'opacity'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">var</span> dayDot <span class="token operator">=</span> hoverElementsGroup<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'circle'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'tooltip-dot'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  bounds<br>    <span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token string">'.voronoi'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'mouseenter'</span><span class="token punctuation">,</span> handleVoronoiMouseEnter<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'mouseleave'</span><span class="token punctuation">,</span> handleVoronoiMouseLeave<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// we need to use a rect instead of a &lt;line> because a line's x1 &amp; x2 attributes won't respect CSS transitions</span><br>  <span class="token comment">// but a path's d attribute will</span><br>  <span class="token keyword">var</span> horizontalLine <span class="token operator">=</span> hoverElementsGroup<br>    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'rect'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'hover-line'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> verticalLine <span class="token operator">=</span> hoverElementsGroup<br>    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'rect'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'hover-line'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  legendGradient<br>    <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'mousemove'</span><span class="token punctuation">,</span> handleLegendMouseMove<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'mouseleave'</span><span class="token punctuation">,</span> handleLegendMouseLeave<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">const</span> legendHighlightBarWidth <span class="token operator">=</span> dimensions<span class="token punctuation">.</span>legendWidth <span class="token operator">*</span> <span class="token number">0.05</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> legendHighlightGroup <span class="token operator">=</span> legendGroup<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'g'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'opacity'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> legendHighlightBar <span class="token operator">=</span> legendHighlightGroup<br>    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'rect'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'legend-highlight-bar'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'width'</span><span class="token punctuation">,</span> legendHighlightBarWidth<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'height'</span><span class="token punctuation">,</span> dimensions<span class="token punctuation">.</span>legendHeight<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// we need to shift the text by half the bar width</span><br>  <span class="token comment">// this lets us center the text with the bar</span><br>  <span class="token keyword">var</span> legendHighlightText <span class="token operator">=</span> legendHighlightGroup<br>    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'text'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'legend-highlight-text'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">,</span> legendHighlightBarWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">function</span> <span class="token function">handleLegendMouseMove</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// we need to determine which dates the mouse is hovering over</span><br>    <span class="token comment">// we can determine the hover point with the mouse's x position relative to the legend</span><br>    <span class="token comment">// mouse() can give us [x,y] coordinates</span><br>    <span class="token comment">// the coordinates are relative to the element passed to mouse()</span><br>    <span class="token comment">// 'this' is the element that the mouse event was initialzed on</span><br><br>    <span class="token keyword">const</span> <span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">mouse</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// use a scale's invert method to go from range dimension -> domain dimension</span><br>    <span class="token keyword">const</span> minDateToHighlight <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><br>      legendTickScale<span class="token punctuation">.</span><span class="token function">invert</span><span class="token punctuation">(</span>x <span class="token operator">-</span> legendHighlightBarWidth<span class="token punctuation">)</span><br>    <span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">const</span> maxDateToHighlight <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><br>      legendTickScale<span class="token punctuation">.</span><span class="token function">invert</span><span class="token punctuation">(</span>x <span class="token operator">+</span> legendHighlightBarWidth<span class="token punctuation">)</span><br>    <span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token comment">// if we use the raw x position of the mouse, it could go out of bounds when we approach</span><br>    <span class="token comment">// the left or right side.</span><br>    <span class="token comment">// we can use median to bound the value</span><br>    <span class="token comment">// There are three outcomes when we pass an array of [min, value, max]:</span><br>    <span class="token comment">// 1) the value is lower than the min, resulting in the sorted array [value, min, max], making min the middle value</span><br>    <span class="token comment">// 2) the value is between the min and the max, resulting in the sorted array [min,value, max], making min the middle value</span><br>    <span class="token comment">// 3) the value is higher than the max, resulting in the sorted array [min, max, value], making max the middle value</span><br>    <span class="token keyword">const</span> barX <span class="token operator">=</span> <span class="token function">median</span><span class="token punctuation">(</span><span class="token punctuation">[</span><br>      <span class="token number">0</span><span class="token punctuation">,</span><br>      x <span class="token operator">-</span> legendHighlightBarWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span><br>      dimensions<span class="token punctuation">.</span>legendWidth <span class="token operator">-</span> legendHighlightBarWidth<span class="token punctuation">,</span><br>    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    legendHighlightGroup<br>      <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">'opacity'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">'transform'</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translateX(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>barX<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    legendHighlightText<br>      <span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">[</span><br>        <span class="token function">timeFormat</span><span class="token punctuation">(</span><span class="token string">'%b %d'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>minDateToHighlight<span class="token punctuation">)</span><span class="token punctuation">,</span><br>        <span class="token function">timeFormat</span><span class="token punctuation">(</span><span class="token string">'%b %d'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>maxDateToHighlight<span class="token punctuation">)</span><span class="token punctuation">,</span><br>      <span class="token punctuation">]</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token comment">// dim normal legend ticks</span><br>    legendValues<span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">'opacity'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    legendValueTicks<span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">'opacity'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    dots<span class="token punctuation">.</span><span class="token function">transition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">duration</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">'opacity'</span><span class="token punctuation">,</span> <span class="token number">0.08</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'r'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">var</span> relevantDots <span class="token operator">=</span> dots<br>      <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>isDayWithinRange<span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">transition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">duration</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">'opacity'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'r'</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">function</span> <span class="token function">getYear</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">return</span> <span class="token operator">+</span><span class="token function">timeFormat</span><span class="token punctuation">(</span><span class="token string">'%Y'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>    <span class="token keyword">function</span> <span class="token function">isDayWithinRange</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token comment">// we want to highlight dates on each edge when we get close to the edge</span><br>      <span class="token keyword">var</span> date <span class="token operator">=</span> <span class="token function">colorAccessor</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getYear</span><span class="token punctuation">(</span>minDateToHighlight<span class="token punctuation">)</span> <span class="token operator">&lt;</span> colorScaleYear<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token comment">// if dates wrap around to the previous year</span><br>        <span class="token comment">// check if the date is after the min date</span><br>        <span class="token keyword">return</span> <span class="token punctuation">(</span><br>          date <span class="token operator">>=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>minDateToHighlight<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setYear</span><span class="token punctuation">(</span>colorScaleYear<span class="token punctuation">)</span> <span class="token operator">||</span><br>          date <span class="token operator">&lt;=</span> maxDateToHighlight<br>        <span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getYear</span><span class="token punctuation">(</span>maxDateToHighlight<span class="token punctuation">)</span> <span class="token operator">></span> colorScaleYear<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token comment">// if dates wrap around to next year</span><br>        <span class="token comment">// check if the date is before the max date</span><br>        <span class="token keyword">return</span> <span class="token punctuation">(</span><br>          date <span class="token operator">&lt;=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>maxDateToHighlight<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setYear</span><span class="token punctuation">(</span>colorScaleYear<span class="token punctuation">)</span> <span class="token operator">||</span><br>          date <span class="token operator">>=</span> minDateToHighlight<br>        <span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>        <span class="token keyword">return</span> date <span class="token operator">>=</span> minDateToHighlight <span class="token operator">&amp;&amp;</span> date <span class="token operator">&lt;=</span> maxDateToHighlight<span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">function</span> <span class="token function">handleLegendMouseLeave</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    dots<span class="token punctuation">.</span><span class="token function">transition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">duration</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">'opacity'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'r'</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    legendHighlightGroup<span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">'opacity'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    legendValues<span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">'opacity'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    legendValueTicks<span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">'opacity'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">function</span> <span class="token function">handleVoronoiMouseEnter</span><span class="token punctuation">(</span><span class="token parameter">datum<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    tooltip<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'#min-temperature'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token function">formatMetric</span><span class="token punctuation">(</span><span class="token function">xAccessor</span><span class="token punctuation">(</span>datum<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    tooltip<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'#max-temperature'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token function">formatMetric</span><span class="token punctuation">(</span><span class="token function">yAccessor</span><span class="token punctuation">(</span>datum<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    tooltip<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'#date'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token function">formatDate</span><span class="token punctuation">(</span><span class="token function">dateParser</span><span class="token punctuation">(</span>datum<span class="token punctuation">.</span>date<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token comment">// get x and y value of the dot, offset by top and left margins</span><br>    <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token function">xScale</span><span class="token punctuation">(</span><span class="token function">xAccessor</span><span class="token punctuation">(</span>datum<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">const</span> y <span class="token operator">=</span> <span class="token function">yScale</span><span class="token punctuation">(</span><span class="token function">yAccessor</span><span class="token punctuation">(</span>datum<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">const</span> tooltipX <span class="token operator">=</span> x <span class="token operator">+</span> dimensions<span class="token punctuation">.</span>margin<span class="token punctuation">.</span>left<span class="token punctuation">;</span><br>    <span class="token keyword">const</span> tooltipY <span class="token operator">=</span> y <span class="token operator">+</span> dimensions<span class="token punctuation">.</span>margin<span class="token punctuation">.</span>top <span class="token operator">-</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token comment">// adjust 4px to prevent overlap with circle</span><br><br>    tooltip<br>      <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><br>        <span class="token string">'transform'</span><span class="token punctuation">,</span><br>        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translate(calc(-50% + </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>tooltipX<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px), calc(-100% + </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>tooltipY<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px))</span><span class="token template-punctuation string">`</span></span><br>      <span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">'opacity'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    dayDot<br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'cx'</span><span class="token punctuation">,</span> <span class="token function">xScale</span><span class="token punctuation">(</span><span class="token function">xAccessor</span><span class="token punctuation">(</span>datum<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'cy'</span><span class="token punctuation">,</span> <span class="token function">yScale</span><span class="token punctuation">(</span><span class="token function">yAccessor</span><span class="token punctuation">(</span>datum<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'r'</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">const</span> hoverLineThickness <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span><br><br>    horizontalLine<br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">,</span> y <span class="token operator">-</span> hoverLineThickness <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><br>        <span class="token string">'width'</span><span class="token punctuation">,</span><br>        dimensions<span class="token punctuation">.</span>boundedWidth <span class="token operator">+</span><br>          dimensions<span class="token punctuation">.</span>histogramMargin <span class="token operator">+</span><br>          dimensions<span class="token punctuation">.</span>histogramHeight <span class="token operator">-</span><br>          x<br>      <span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'height'</span><span class="token punctuation">,</span> hoverLineThickness<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    verticalLine<br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">,</span> x <span class="token operator">-</span> hoverLineThickness <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token operator">-</span>dimensions<span class="token punctuation">.</span>histogramMargin <span class="token operator">-</span> dimensions<span class="token punctuation">.</span>histogramHeight<span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'width'</span><span class="token punctuation">,</span> hoverLineThickness<span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><br>        <span class="token string">'height'</span><span class="token punctuation">,</span><br>        y <span class="token operator">+</span> dimensions<span class="token punctuation">.</span>histogramMargin <span class="token operator">+</span> dimensions<span class="token punctuation">.</span>histogramHeight<br>      <span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    hoverElementsGroup<span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">'opacity'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token comment">// draw new dot to appear on top</span><br>  <span class="token punctuation">}</span><br>  <span class="token keyword">function</span> <span class="token function">handleVoronoiMouseLeave</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    tooltip<span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">'opacity'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    hoverElementsGroup<span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">'opacity'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><span class="token function">drawScatter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>


<p><a href="/blog/">← Home</a></p>

    </main>

    <footer></footer>

    <!-- Current page: /blog/posts/june-13-2020/ -->
  </body>
</html>
