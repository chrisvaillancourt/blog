<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>100 Days of Code - Day 19</title>
    <meta name="Description" content="d3 svg map">
    <link rel="stylesheet" href="/blog/css/index.css">
    <link rel="stylesheet" href="/blog/css/prism-base16-monokai.dark.css">
    <link rel="alternate" href="/blog/feed/feed.xml" type="application/atom+xml" title="Dev Blog">
  </head>
  <body>
    <header>
      <h1 class="home"><a href="/blog/">Dev Blog</a></h1>
      <ul class="nav">
        <li class="nav-item"><a href="/blog/">Home</a></li>
        <li class="nav-item"><a href="/blog/posts/">Archive</a></li>
        <li class="nav-item"><a href="/blog/about/">About Me</a></li>
      </ul>
    </header>

    <main class="tmpl-post">

      <h1>100 Days of Code - Day 19</h1>

<h3 id="day-19%3A-june-1%2C-2020">Day 19: June 1, 2020 <a class="direct-link" href="#day-19%3A-june-1%2C-2020">#</a></h3>
<h4 id="today's-progress">Today's Progress <a class="direct-link" href="#today's-progress">#</a></h4>
<p>Today I created a SVG world map with D3.</p>
<h4 id="thoughts">Thoughts <a class="direct-link" href="#thoughts">#</a></h4>
<p>D3 is a wonderfully designed library and I love the fine-grain control it offers. I'm excited to create another D3 map with <code>&lt;canvas&gt;</code> element.</p>
<h4 id="work-examples">Work examples <a class="direct-link" href="#work-examples">#</a></h4>
<p><a href="https://chrisvaillancourt.github.io/d3-examples/svg-world-map/">SVG World Map</a></p>
<pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token string">'./svg-world-map.css'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> json<span class="token punctuation">,</span> csv <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'d3-fetch'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> geoEqualEarth<span class="token punctuation">,</span> geoPath<span class="token punctuation">,</span> geoGraticule10 <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'d3-geo'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> select<span class="token punctuation">,</span> selectAll <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'d3-selection'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> extent<span class="token punctuation">,</span> max <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'d3-array'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> scaleLinear <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'d3-scale'</span><span class="token punctuation">;</span><br><br>console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">'draw map'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">createMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token comment">// step 1) load data</span><br><br>  <span class="token keyword">var</span> countryShapes <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">json</span><span class="token punctuation">(</span><span class="token string">'../data/world-geojson.json'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> dataset <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">csv</span><span class="token punctuation">(</span><span class="token string">'../data/data_bank_data.csv'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> metric <span class="token operator">=</span> <span class="token string">'Population growth (annual %)'</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">function</span> <span class="token function">countryNameAccessor</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> d<span class="token punctuation">.</span>properties<span class="token punctuation">[</span><span class="token string">'NAME'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  <span class="token keyword">function</span> <span class="token function">countryIdAccessor</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> d<span class="token punctuation">.</span>properties<span class="token punctuation">[</span><span class="token string">'ADM0_A3_IS'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  <span class="token keyword">var</span> metricDataByCountry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  dataset<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">getCountryMetric</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>d<span class="token punctuation">[</span><span class="token string">'Series Name'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> metric<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span><br>    metricDataByCountry<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>d<span class="token punctuation">[</span><span class="token string">'Country Code'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token function">Number</span><span class="token punctuation">(</span>d<span class="token punctuation">[</span><span class="token string">'2017 [YR2017]'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token comment">// step 2) create chart dimensions</span><br>  <span class="token keyword">var</span> dimensions <span class="token operator">=</span> <span class="token punctuation">{</span><br>    width<span class="token operator">:</span> window<span class="token punctuation">.</span>innerWidth <span class="token operator">*</span> <span class="token number">0.9</span><span class="token punctuation">,</span><br>    margin<span class="token operator">:</span> <span class="token punctuation">{</span><br>      top<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span><br>      right<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span><br>      bottom<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span><br>      left<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>  dimensions<span class="token punctuation">.</span>boundedWidth <span class="token operator">=</span><br>    dimensions<span class="token punctuation">.</span>width <span class="token operator">-</span> dimensions<span class="token punctuation">.</span>margin<span class="token punctuation">.</span>left <span class="token operator">-</span> dimensions<span class="token punctuation">.</span>margin<span class="token punctuation">.</span>right<span class="token punctuation">;</span><br>  <span class="token comment">// height of the map will be set by the map projection</span><br><br>  <span class="token keyword">var</span> sphere <span class="token operator">=</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'Sphere'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// a projection function is a scale for geo data</span><br>  <span class="token comment">// we need to update the projection's width</span><br>  <span class="token keyword">var</span> projection <span class="token operator">=</span> <span class="token function">geoEqualEarth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fitWidth</span><span class="token punctuation">(</span>dimensions<span class="token punctuation">.</span>boundedWidth<span class="token punctuation">,</span> sphere<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> pathGenerator <span class="token operator">=</span> <span class="token function">geoPath</span><span class="token punctuation">(</span>projection<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>x0<span class="token punctuation">,</span> y0<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>x1<span class="token punctuation">,</span> y1<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> pathGenerator<span class="token punctuation">.</span><span class="token function">bounds</span><span class="token punctuation">(</span>sphere<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  dimensions<span class="token punctuation">.</span>boundedHeight <span class="token operator">=</span> y1<span class="token punctuation">;</span><br>  dimensions<span class="token punctuation">.</span>height <span class="token operator">=</span><br>    dimensions<span class="token punctuation">.</span>boundedHeight <span class="token operator">+</span> dimensions<span class="token punctuation">.</span>margin<span class="token punctuation">.</span>top <span class="token operator">+</span> dimensions<span class="token punctuation">.</span>margin<span class="token punctuation">.</span>bottom<span class="token punctuation">;</span><br>  <span class="token comment">// step 3) draw canvas</span><br><br>  <span class="token keyword">var</span> wrapper <span class="token operator">=</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'#wrapper'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'svg'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'width'</span><span class="token punctuation">,</span> dimensions<span class="token punctuation">.</span>width<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'height'</span><span class="token punctuation">,</span> dimensions<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">var</span> bounds <span class="token operator">=</span> wrapper<br>    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'g'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><br>      <span class="token string">'transform'</span><span class="token punctuation">,</span><br>      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translate(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dimensions<span class="token punctuation">.</span>margin<span class="token punctuation">.</span>left<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dimensions<span class="token punctuation">.</span>margin<span class="token punctuation">.</span>top<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><br>    <span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token comment">// step 4) set-up scales</span><br>  <span class="token comment">// prokection covers our x and y scales</span><br><br>  <span class="token keyword">var</span> metricValues <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>metricDataByCountry<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> metricValueExtent <span class="token operator">=</span> <span class="token function">extent</span><span class="token punctuation">(</span>metricValues<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token comment">// if we use a domain and range with more than 2 values, d3 will create a scale with more than two 'anchors'</span><br><br>  <span class="token keyword">var</span> maxChange <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">-</span>metricValueExtent<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> metricValueExtent<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token comment">// var colorScale = scaleLinear()</span><br>  <span class="token comment">//   .domain([-maxChange, 0, maxChange])</span><br>  <span class="token comment">//   .range('indigo', 'white', 'darkgreen');</span><br>  <span class="token keyword">var</span> colorScale <span class="token operator">=</span> <span class="token function">scaleLinear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">domain</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">-</span>maxChange<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> maxChange<span class="token punctuation">]</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'indigo'</span><span class="token punctuation">,</span> <span class="token string">'white'</span><span class="token punctuation">,</span> <span class="token string">'darkgreen'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// step 5) draw data</span><br><br>  <span class="token keyword">var</span> earth <span class="token operator">=</span> bounds<br>    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'earth'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'d'</span><span class="token punctuation">,</span> <span class="token function">pathGenerator</span><span class="token punctuation">(</span>sphere<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">var</span> graticuleJson <span class="token operator">=</span> <span class="token function">geoGraticule10</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">var</span> graticule <span class="token operator">=</span> bounds<br>    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'graticule'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'d'</span><span class="token punctuation">,</span> <span class="token function">pathGenerator</span><span class="token punctuation">(</span>graticuleJson<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// we want to use countryShapes.features b/c d3 will create an element for each item in the dataset</span><br>  <span class="token comment">// and the features are all we care about</span><br>  <span class="token keyword">var</span> countries <span class="token operator">=</span> bounds<br>    <span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token string">'.country'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>countryShapes<span class="token punctuation">.</span>features<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">enter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'country'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'d'</span><span class="token punctuation">,</span> pathGenerator<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'fill'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">var</span> metricValue <span class="token operator">=</span> metricDataByCountry<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token function">countryIdAccessor</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token keyword">return</span> <span class="token keyword">typeof</span> metricValue <span class="token operator">==</span> <span class="token string">'undefined'</span><br>        <span class="token operator">?</span> <span class="token string">'#e2e6e9'</span><br>        <span class="token operator">:</span> <span class="token function">colorScale</span><span class="token punctuation">(</span>metricValue<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token comment">// step 6) draw peripherals</span><br><span class="token punctuation">}</span><br><br><span class="token function">createMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">'draw map'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>


<p><a href="/blog/">← Home</a></p>

    </main>

    <footer></footer>

    <!-- Current page: /blog/posts/june-1-2020/ -->
  </body>
</html>
