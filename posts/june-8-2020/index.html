<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>100 Days of Code - Day 25</title>
    <meta name="Description" content="Selection">
    <link rel="stylesheet" href="/blog/css/index.css">
    <link rel="stylesheet" href="/blog/css/prism-base16-monokai.dark.css">
    <link rel="alternate" href="/blog/feed/feed.xml" type="application/atom+xml" title="Dev Blog">
  </head>
  <body>
    <header>
      <h1 class="home"><a href="/blog/">Dev Blog</a></h1>
      <ul class="nav">
        <li class="nav-item"><a href="/blog/">Home</a></li>
        <li class="nav-item"><a href="/blog/posts/">Archive</a></li>
        <li class="nav-item"><a href="/blog/about/">About Me</a></li>
      </ul>
    </header>

    <main class="tmpl-post">

      <h1>100 Days of Code - Day 25</h1>

<h3 id="day-25%3A-june-8%2C-2020">Day 25: June 8, 2020 <a class="direct-link" href="#day-25%3A-june-8%2C-2020">#</a></h3>
<h4 id="today's-progress">Today's Progress <a class="direct-link" href="#today's-progress">#</a></h4>
<p>Today I continued work on <a href="https://chrisvaillancourt.github.io/d3-examples/">d3-examples</a> and started adding tests with Jest.</p>
<h4 id="thoughts">Thoughts <a class="direct-link" href="#thoughts">#</a></h4>
<p>I didn't plan well yesterday so I didn't share <a href="https://github.com/chrisvaillancourt/d3-examples/commit/573b0a5d333f011df0199aac06c0c1c459427911">my progress</a>. Some days it's hard to stop coding and reflect that's okay. Failure is a sign of striving and striving is what counts.</p>
<p>Today I added a histogram to a scatter plot's x &amp; y axis, allowing you to see the correlation between metrics as well as the distribution of those metrics.</p>
<p>To do it, pass <code>histogramGenerator</code> the scatter plot's scale and pass it <code>.value(accessor)</code> instead of a range. Then, append a new <a href="https://developer.mozilla.org/en-US/docs/Web/SVG/Element/g">svg group</a> element with a transform. We also use an <a href="https://github.com/d3/d3-shape/blob/v1.3.7/README.md#areas">area generator</a> instead of a line generator so we can ensure our path fills in completely.</p>
<h4 id="work-examples">Work examples <a class="direct-link" href="#work-examples">#</a></h4>
<p>Histogram specific code:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> extent<span class="token punctuation">,</span> histogram <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'d3-array'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> scaleLinear <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'d3-scale'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> area<span class="token punctuation">,</span> curveBasis <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'d3-shape'</span><span class="token punctuation">;</span><br><br><span class="token keyword">function</span> <span class="token function">drawHistogram</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span><br>  data<span class="token punctuation">,</span><br>  scale<span class="token punctuation">,</span><br>  accessor<span class="token punctuation">,</span><br>  dimensions<span class="token punctuation">,</span><br>  histogramClass<span class="token punctuation">,</span><br>  chartTransform<span class="token punctuation">,</span><br>  chartBounds<span class="token punctuation">,</span><br>  pathClass<span class="token punctuation">,</span><br><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">var</span> histogramGenerator <span class="token operator">=</span> <span class="token function">histogram</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">domain</span><span class="token punctuation">(</span>scale<span class="token punctuation">.</span><span class="token function">domain</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span>accessor<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">thresholds</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> histogramBins <span class="token operator">=</span> <span class="token function">histogramGenerator</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> histogramYScale <span class="token operator">=</span> <span class="token function">scaleLinear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">domain</span><span class="token punctuation">(</span><span class="token function">extent</span><span class="token punctuation">(</span>histogramBins<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> d<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token punctuation">[</span>dimensions<span class="token punctuation">.</span>histogramHeight<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> histogramBounds <span class="token operator">=</span> chartBounds<br>    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'g'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> histogramClass<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">'transform'</span><span class="token punctuation">,</span> chartTransform<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> histogramLineGenerator <span class="token operator">=</span> <span class="token function">area</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">scale</span><span class="token punctuation">(</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>x0 <span class="token operator">+</span> d<span class="token punctuation">.</span>x1<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">y0</span><span class="token punctuation">(</span>dimensions<span class="token punctuation">.</span>histogramHeight<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">y1</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">histogramYScale</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">curve</span><span class="token punctuation">(</span>curveBasis<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> histogramElement <span class="token operator">=</span> histogramBounds<br>    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'d'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">histogramLineGenerator</span><span class="token punctuation">(</span>histogramBins<span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> pathClass<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p>Marginal histogram (<a href="https://chrisvaillancourt.github.io/d3-examples/marginal-histogram/">unfinished</a>):</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> json <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'d3-fetch'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> min<span class="token punctuation">,</span> extent<span class="token punctuation">,</span> histogram <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'d3-array'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> select<span class="token punctuation">,</span> selectAll <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'d3-selection'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> scaleLinear<span class="token punctuation">,</span> scaleSequential <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'d3-scale'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> axisBottom<span class="token punctuation">,</span> axisLeft <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'d3-axis'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> format <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'d3-format'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> Delaunay <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'d3-delaunay'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> timeFormat<span class="token punctuation">,</span> timeParse <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'d3-time-format'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> interpolateRainbow <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'d3-scale-chromatic'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> area<span class="token punctuation">,</span> curveBasis <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'d3-shape'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> drawHistogram <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../utils/drawHistogram'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> createDimensions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../utils/createDimensions'</span><span class="token punctuation">;</span><br><br><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">drawScatter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token comment">// 1. Access data</span><br><br>  <span class="token keyword">const</span> dataset <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">json</span><span class="token punctuation">(</span><span class="token string">'../data/nyc_weather_data.json'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">function</span> <span class="token function">xAccessor</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> d<span class="token punctuation">.</span>temperatureMin<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  <span class="token keyword">function</span> <span class="token function">yAccessor</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> d<span class="token punctuation">.</span>temperatureMax<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  <span class="token comment">// use a standard date to normalize our data with.</span><br>  <span class="token comment">// We'll do this in-case our data spans multiple years</span><br>  <span class="token comment">// allowing us to color the dots by the day/month</span><br>  <span class="token keyword">const</span> colorScaleYear <span class="token operator">=</span> <span class="token number">2000</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> parseDate <span class="token operator">=</span> <span class="token function">timeParse</span><span class="token punctuation">(</span><span class="token string">'%Y-%m-%d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">function</span> <span class="token function">colorAccessor</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> <span class="token function">parseDate</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>date<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setYear</span><span class="token punctuation">(</span>colorScaleYear<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  <span class="token comment">// 2. Create chart dimensions</span><br>  <span class="token keyword">var</span> dimensions <span class="token operator">=</span> <span class="token function">createDimensions</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>    customDimensions<span class="token operator">:</span> <span class="token punctuation">{</span><br>      histogramMargin<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span><br>      histogramHeight<span class="token operator">:</span> <span class="token number">70</span><span class="token punctuation">,</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// 3. Draw canvas</span><br><br>  <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'#wrapper'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'svg'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'width'</span><span class="token punctuation">,</span> dimensions<span class="token punctuation">.</span>width<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'height'</span><span class="token punctuation">,</span> dimensions<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">const</span> bounds <span class="token operator">=</span> wrapper<br>    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'g'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><br>      <span class="token string">'transform'</span><span class="token punctuation">,</span><br>      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translate(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dimensions<span class="token punctuation">.</span>margin<span class="token punctuation">.</span>left<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dimensions<span class="token punctuation">.</span>margin<span class="token punctuation">.</span>top<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px)</span><span class="token template-punctuation string">`</span></span><br>    <span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> boundsBackground <span class="token operator">=</span> bounds<br>    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'rect'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">classed</span><span class="token punctuation">(</span><span class="token string">'bounds-background'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'width'</span><span class="token punctuation">,</span> dimensions<span class="token punctuation">.</span>boundedWidth<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'height'</span><span class="token punctuation">,</span> dimensions<span class="token punctuation">.</span>boundedHeight<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// 4. Create scales</span><br><br>  <span class="token comment">// find the smallest min temp and largest max temp</span><br>  <span class="token comment">// we'll use the extent as the domain for both x &amp; y axis</span><br>  <span class="token keyword">var</span> tempsExtent <span class="token operator">=</span> <span class="token function">extent</span><span class="token punctuation">(</span><span class="token punctuation">[</span><br>    <span class="token operator">...</span>dataset<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>xAccessor<span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token operator">...</span>dataset<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>yAccessor<span class="token punctuation">)</span><span class="token punctuation">,</span><br>  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">const</span> xScale <span class="token operator">=</span> <span class="token function">scaleLinear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">domain</span><span class="token punctuation">(</span>tempsExtent<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> dimensions<span class="token punctuation">.</span>boundedWidth<span class="token punctuation">]</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">nice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">const</span> yScale <span class="token operator">=</span> <span class="token function">scaleLinear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">domain</span><span class="token punctuation">(</span>tempsExtent<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token punctuation">[</span>dimensions<span class="token punctuation">.</span>boundedHeight<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">nice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token comment">// use a sequential scale to cover the entire year</span><br><br>  <span class="token keyword">var</span> colorScale <span class="token operator">=</span> <span class="token function">scaleSequential</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">domain</span><span class="token punctuation">(</span><span class="token punctuation">[</span><br>      <span class="token function">timeParse</span><span class="token punctuation">(</span><span class="token string">'%m/%d/%Y'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">1/1/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>colorScaleYear<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>      <span class="token function">timeParse</span><span class="token punctuation">(</span><span class="token string">'%m/%d/%Y'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">12/31/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>colorScaleYear<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token punctuation">]</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">interpolator</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">invertDate</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token comment">// flip the value to better correspond with season colors</span><br>      <span class="token keyword">return</span> <span class="token function">interpolateRainbow</span><span class="token punctuation">(</span><span class="token operator">-</span>d<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">const</span> <span class="token function-variable function">drawDots</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">dataset</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token comment">// 5. Draw data</span><br>    <span class="token keyword">var</span> dotsGroup <span class="token operator">=</span> bounds<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'g'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">const</span> dots <span class="token operator">=</span> dotsGroup<br>      <span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token string">'.dot'</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>dataset<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> d<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'circle'</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'dot'</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'cx'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">xScale</span><span class="token punctuation">(</span><span class="token function">xAccessor</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'cy'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">yScale</span><span class="token punctuation">(</span><span class="token function">yAccessor</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'r'</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">'fill'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">setFill</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">return</span> <span class="token function">colorScale</span><span class="token punctuation">(</span><span class="token function">colorAccessor</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>  <span class="token function">drawDots</span><span class="token punctuation">(</span>dataset<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token function">drawHistogram</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>    data<span class="token operator">:</span> dataset<span class="token punctuation">,</span><br>    scale<span class="token operator">:</span> yScale<span class="token punctuation">,</span><br>    accessor<span class="token operator">:</span> yAccessor<span class="token punctuation">,</span><br>    chartBounds<span class="token operator">:</span> bounds<span class="token punctuation">,</span><br>    dimensions<span class="token punctuation">,</span><br>    histogramClass<span class="token operator">:</span> <span class="token string">'top-histogram'</span><span class="token punctuation">,</span><br>    pathClass<span class="token operator">:</span> <span class="token string">'histogram-area'</span><span class="token punctuation">,</span><br>    chartTransform<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translate(<br>        </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dimensions<span class="token punctuation">.</span>boundedWidth <span class="token operator">+</span> dimensions<span class="token punctuation">.</span>histogramMargin<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px, -</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><br>      dimensions<span class="token punctuation">.</span>histogramHeight<br>    <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px) rotate(90deg)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token function">drawHistogram</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>    data<span class="token operator">:</span> dataset<span class="token punctuation">,</span><br>    scale<span class="token operator">:</span> xScale<span class="token punctuation">,</span><br>    accessor<span class="token operator">:</span> xAccessor<span class="token punctuation">,</span><br>    chartBounds<span class="token operator">:</span> bounds<span class="token punctuation">,</span><br>    dimensions<span class="token punctuation">,</span><br>    histogramClass<span class="token operator">:</span> <span class="token string">'right-histogram'</span><span class="token punctuation">,</span><br>    pathClass<span class="token operator">:</span> <span class="token string">'histogram-area'</span><span class="token punctuation">,</span><br>    chartTransform<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translate(0px, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><br>      <span class="token operator">-</span>dimensions<span class="token punctuation">.</span>histogramHeight <span class="token operator">-</span> dimensions<span class="token punctuation">.</span>histogramMargin<br>    <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token comment">// create a new Delaunay triangulation for interaction</span><br>  <span class="token keyword">var</span> delaunay <span class="token operator">=</span> Delaunay<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><br>    dataset<span class="token punctuation">,</span><br>    <span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">xScale</span><span class="token punctuation">(</span><span class="token function">xAccessor</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">yScale</span><span class="token punctuation">(</span><span class="token function">yAccessor</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><br>  <span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// turn the delaunay triangulation into a voronoi diagram</span><br>  <span class="token keyword">var</span> voronoi <span class="token operator">=</span> delaunay<span class="token punctuation">.</span><span class="token function">voronoi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// specify bounds size</span><br>  voronoi<span class="token punctuation">.</span>xmax <span class="token operator">=</span> dimensions<span class="token punctuation">.</span>boundedWidth<span class="token punctuation">;</span><br>  voronoi<span class="token punctuation">.</span>ymax <span class="token operator">=</span> dimensions<span class="token punctuation">.</span>boundedHeight<span class="token punctuation">;</span><br><br>  bounds<br>    <span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token string">'.voronoi'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>dataset<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">enter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'voronoi'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'d'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">createPath</span><span class="token punctuation">(</span><span class="token parameter">d<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token comment">// create each path's d attribute string by passing voronoi.randerCell() the index</span><br>      <span class="token comment">// of our data point</span><br>      <span class="token keyword">return</span> voronoi<span class="token punctuation">.</span><span class="token function">renderCell</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// 6. Draw peripherals</span><br><br>  <span class="token keyword">const</span> xAxisGenerator <span class="token operator">=</span> <span class="token function">axisBottom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">scale</span><span class="token punctuation">(</span>xScale<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">const</span> xAxis <span class="token operator">=</span> bounds<br>    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'g'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>xAxisGenerator<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">'transform'</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translateY(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dimensions<span class="token punctuation">.</span>boundedHeight<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">const</span> xAxisLabel <span class="token operator">=</span> xAxis<br>    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'text'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'x-axis-label'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">,</span> dimensions<span class="token punctuation">.</span>boundedWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">,</span> dimensions<span class="token punctuation">.</span>margin<span class="token punctuation">.</span>bottom <span class="token operator">-</span> <span class="token number">10</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">'Minimum Temperature (&amp;deg;F)'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">const</span> yAxisGenerator <span class="token operator">=</span> <span class="token function">axisLeft</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">scale</span><span class="token punctuation">(</span>yScale<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ticks</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">const</span> yAxis <span class="token operator">=</span> bounds<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'g'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>yAxisGenerator<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">const</span> yAxisLabel <span class="token operator">=</span> yAxis<br>    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'text'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'y-axis-label'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">,</span> <span class="token operator">-</span>dimensions<span class="token punctuation">.</span>boundedHeight <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token operator">-</span>dimensions<span class="token punctuation">.</span>margin<span class="token punctuation">.</span>left <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">'Maximum Temperature (&amp;deg;F)'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// 7. Set up interactions</span><br>  <span class="token keyword">var</span> tooltip <span class="token operator">=</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'#tooltip'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> formatHumidity <span class="token operator">=</span> <span class="token function">format</span><span class="token punctuation">(</span><span class="token string">'.2f'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> formatDewPoint <span class="token operator">=</span> <span class="token function">format</span><span class="token punctuation">(</span><span class="token string">'.2f'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> dateParser <span class="token operator">=</span> <span class="token function">timeParse</span><span class="token punctuation">(</span><span class="token string">'%Y-%m-%d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> formatDate <span class="token operator">=</span> <span class="token function">timeFormat</span><span class="token punctuation">(</span><span class="token string">'%B %A %-d, %Y'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  bounds<br>    <span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token string">'.voronoi'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'mouseenter'</span><span class="token punctuation">,</span> handleMouseEnter<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'mouseleave'</span><span class="token punctuation">,</span> handleMouseLeave<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">function</span> <span class="token function">handleMouseEnter</span><span class="token punctuation">(</span><span class="token parameter">datum<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    tooltip<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'#humidity'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token function">formatHumidity</span><span class="token punctuation">(</span><span class="token function">yAccessor</span><span class="token punctuation">(</span>datum<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    tooltip<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'#dew-point'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token function">formatDewPoint</span><span class="token punctuation">(</span><span class="token function">xAccessor</span><span class="token punctuation">(</span>datum<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    tooltip<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'#date'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token function">formatDate</span><span class="token punctuation">(</span><span class="token function">dateParser</span><span class="token punctuation">(</span>datum<span class="token punctuation">.</span>date<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token comment">// get x and y value of the dot, offset by top and left margins</span><br>    <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token function">xScale</span><span class="token punctuation">(</span><span class="token function">xAccessor</span><span class="token punctuation">(</span>datum<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> dimensions<span class="token punctuation">.</span>margin<span class="token punctuation">.</span>left<span class="token punctuation">;</span><br>    <span class="token keyword">const</span> y <span class="token operator">=</span> <span class="token function">yScale</span><span class="token punctuation">(</span><span class="token function">yAccessor</span><span class="token punctuation">(</span>datum<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> dimensions<span class="token punctuation">.</span>margin<span class="token punctuation">.</span>top<span class="token punctuation">;</span><br><br>    tooltip<br>      <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><br>        <span class="token string">'transform'</span><span class="token punctuation">,</span><br>        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translate(calc(-50% + </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>x<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px), calc(-100% + </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>y<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px))</span><span class="token template-punctuation string">`</span></span><br>      <span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">'opacity'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// draw new dot to appear on top</span><br>    <span class="token keyword">var</span> dayDot <span class="token operator">=</span> bounds<br>      <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'circle'</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'tooltipDot'</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'cx'</span><span class="token punctuation">,</span> <span class="token function">xScale</span><span class="token punctuation">(</span><span class="token function">xAccessor</span><span class="token punctuation">(</span>datum<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'cy'</span><span class="token punctuation">,</span> <span class="token function">yScale</span><span class="token punctuation">(</span><span class="token function">yAccessor</span><span class="token punctuation">(</span>datum<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'r'</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">'fill'</span><span class="token punctuation">,</span> <span class="token string">'maroon'</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">'pointer-events'</span><span class="token punctuation">,</span> <span class="token string">'none'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  <span class="token keyword">function</span> <span class="token function">handleMouseLeave</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    tooltip<span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">'opacity'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token string">'.tooltipDot'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><span class="token function">drawScatter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">'render chart'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span><br></code></pre>


<p><a href="/blog/">← Home</a></p>

    </main>

    <footer></footer>

    <!-- Current page: /blog/posts/june-8-2020/ -->
  </body>
</html>
